0000                             ; ----------------------------------------------------------------------------
0000                             ;Micro-Soft Altair BASIC 3.2 (4K) - Annotated Disassembly
0000                             ;	
0000                             ;Copyright 1975, Bill Gates, Paul Allen, Monte Davidoff
0000                             ;Source: http://altairbasic.org/ compiled by Reuben Harris
0000                             ;Additional cleanup, relocation by Charles Mangin, March, 2019
0000                             ; ----------------------------------------------------------------------------
0000                UART_RX:   EQU   $18   
0000                UART_TX:   EQU   $18   
0000                UART_RX_STATUS:   EQU   $19   
0000                UART_TX_STATUS:   EQU   $19   
0000                UART_RX_FULL:   EQU   $01   
0000                UART_TX_EMPTY:   EQU   $04   
0000                STK_TOP:   EQU   0x0F1A   
0000                MEM_TOP:   EQU   0x2000   
0000                          .ORG   00   
0000   F3           START:    DI      
0001   C3 25 0D               JMP   Init   
0004   90 04                  DW   0490h   
0006   F9 07                  DW   07F9h   
0008                             ; RST 1
0008   7E           SYNTAXCHECK:   MOV   A,M   ;A=Byte of BASIC program.
0009   E3                     XTHL      ;HL=return address.
000A   BE                     CMP   M   ;Compare to byte expected.
000B   23                     INX   H   ;Return address++;
000C   E3                     XTHL      ; 
000D   C2 D0 01               JNZ   SyntaxError   ;Error if not what was expected.
0010                             ; RST 2
0010   23           NEXTCHAR:   INX   H   
0011   7E                     MOV   A,M   
0012   FE 3A                  CPI   0x3A   
0014   D0                     RNC      
0015   C3 68 04               JMP   NextChar_tail   
0018                             ; RST 3
0018   F5           OUTCHAR:   PUSH   PSW   
0019   3A 27 00               LDA   TERMINAL_X   
001C   C3 6E 03               JMP   OutChar_tail   
001F   00                     NOP      
0020                             ; RST 4
0020   7C           COMPAREHLDE:   MOV   A,H   
0021   92                     SUB   D   
0022   C0                     RNZ      
0023   7D                     MOV   A,L   
0024   93                     SUB   E   
0025   C9                     RET      
0026   01           TERMINAL_Y:   DB   01   
0027   00           TERMINAL_X:   DB   00   
0028                             ; RST 5
0028   3A 72 01     FTESTSIGN:   LDA   FACCUM+3   
002B   B7                     ORA   A   
002C   C2 DE 09               JNZ   FTestSign_tail   
002F   C9                     RET      
0030                             ; RST 6
0030   E3           PUSHNEXTWORD:   XTHL      
0031   22 3B 00               SHLD   L003A+1   
0034   E1                     POP   H   
0035   4E                     MOV   C,M   
0036   23                     INX   H   
0037   46                     MOV   B,M   
0038   23                     INX   H   
0039   C5                     PUSH   B   
003A   C3 3A 00     L003A:    JMP   L003A   
003D   E8 09        KW_INLINE_FNS:   DW   Sgn   
003F   A6 0A                  DW   Int   
0041   FC 09                  DW   Abs   
0043   A6 04                  DW   FunctionCallError   
0045   25 0C                  DW   Sqr   
0047   63 0C                  DW   Rnd   
0049   99 0C                  DW   Sin   
004B   79           KW_ARITH_OP_FNS:   DB   79h   
004C   14 08                  DW   FAdd   ;+
004E   79                     DB   79h   
004F   0E 08                  DW   FSub   ;-
0051   7C                     DB   7Ch   
0052   E7 08                  DW   FMul   ;*
0054   7C                     DB   7Ch   
0055   33 09                  DW   FDiv   ;/
0057   45 4E C4     KEYWORDS:   DB   45h,4Eh,0C4h   ; "END"	80
005A   46 4F D2               DB   46h,4Fh,0D2h   ; "FOR"
005D   4E 45 58 D4            DB   4Eh,45h,58h,0D4h   ; "NEXT"	82
0061   44 41 54 C1            DB   44h,41h,54h,0C1h   ; "DATA"	83
0065   49 4E 50 55 D4         DB   49h,4Eh,50h,55h,0D4h   ; "INPUT"	84
006A   44 49 CD               DB   44h,49h,0CDh   ; "DIM"	85
006D   52 45 41 C4            DB   52h,45h,41h,0C4h   ; "READ"	86
0071   4C 45 D4               DB   4Ch,45h,0D4h   ; "LET"	87
0074   47 4F 54 CF            DB   47h,4Fh,54h,0CFh   ; "GOTO"	88
0078   52 55 CE               DB   52h,55h,0CEh   ; "RUN"	89
007B   49 C6                  DB   49h,0C6h   ; "IF"	8A	; Ifl
007D   52 45 53 54 4F 52 C5   DB   52h,45h,53h,54h,4Fh,52h,0C5h   ; "RESTORE"	8B
0084   47 4F 53 55 C2         DB   47h,4Fh,53h,55h,0C2h   ; "GOSUB"	8C
0089   52 45 54 55 52 CE      DB   52h,45h,54h,55h,52h,0CEh   ; "RETURN"	8D
008F   52 45 CD               DB   52h,45h,0CDh   ; "REM"	8E
0092   53 54 4F D0            DB   53h,54h,4Fh,0D0h   ; "STOP"	8F
0096   50 52 49 4E D4         DB   50h,52h,49h,4Eh,0D4h   ; "PRINT"	90
009B   4C 49 53 D4            DB   4Ch,49h,53h,0D4h   ; "LIST"	91
009F   43 4C 45 41 D2         DB   43h,4Ch,45h,41h,0D2h   ; "CLEAR"	92
00A4   4E 45 D7               DB   4Eh,45h,0D7h   ; "NEW"	93
00A7                             ; 
00A7   54 41 42 A8            DB   54h,41h,42h,0A8h   ; "TAB("	94
00AB   54 CF                  DB   54h,0CFh   ; "TO"	95
00AD   54 48 45 CE            DB   54h,48h,45h,0CEh   ; "THEN"	96
00B1   53 54 45 D0            DB   53h,54h,45h,0D0h   ; "STEP"	97
00B5                             ; 
00B5   AB                     DB   0xAB   ; 	"+"	98
00B6   AD                     DB   0xAD   ; 	"-"	99
00B7   AA                     DB   0xAA   ; 	"*"	9A
00B8   AF                     DB   0xAF   ; 	"/"	9B
00B9   BE                     DB   0xBE   ; 	">"	9C
00BA   BD                     DB   0xBD   ; 	"="	9D
00BB   BC                     DB   0xBC   ; 	"<"	9E
00BC                             ; 
00BC   53 47 CE               DB   53h,47h,0CEh   ; 	"SGN"	9F
00BF   49 4E D4               DB   49h,4Eh,0D4h   ; 	"INT"	A0
00C2   41 42 D3               DB   41h,42h,0D3h   ; 	"ABS"	A1
00C5   55 53 D2               DB   55h,53h,0D2h   ; 	"USR"	A2
00C8   53 51 D2               DB   53h,51h,0D2h   ; 	"SQR"	A3
00CB   52 4E C4               DB   52h,4Eh,0C4h   ; 	"RND"	A4
00CE   53 49 CE               DB   53h,49h,0CEh   ; 	"SIN"	A5
00D1                             ; 
00D1   00                     DB   0x00   ; 	 	
00D2                             ; 
00D2   F7 01        KW_GENERAL_FNS:   DW   Stop   ;END
00D4   DF 03                  DW   For   ;FOR
00D6   4D 06                  DW   Next   ;NEXT
00D8   03 05                  DW   FindNextStatement   ;DATA
00DA   E8 05                  DW   Input   ;INPUT
00DC   1A 07                  DW   Dim   ;DIM
00DE   FA 05                  DW   Read   ;READ
00E0   10 05                  DW   Let   ;LET
00E2   DD 04                  DW   Goto   ;GOTO
00E4   A1 02                  DW   Run   ;RUN
00E6   24 05                  DW   Ifl   ;IF
00E8   73 04                  DW   Restore   ;RESTORE
00EA   CC 04                  DW   Gosub   ;GOSUB
00EC   ED 04                  DW   Return   ;RETURN
00EE   05 05                  DW   Rem   ;REM
00F0   F7 01                  DW   Stop   ;STOP
00F2   65 05                  DW   Print   ;PRINT
00F4   98 03                  DW   List   ;LIST
00F6   A6 02                  DW   Clear   ;CLEAR
00F8   95 02                  DW   New   ;NEW
00FA   4E C6        ERROR_CODES:   DB   4Eh,0C6h   ;"NF"	NEXT without FOR.
00FC   53 CE                  DB   53h,0CEh   ;"SN"	Syntax Error
00FE   52 C7                  DB   52h,0C7h   ;"RG"	RETURN without GOSUB.
0100   4F C4                  DB   4Fh,0C4h   ;"OD"	Out of Data
0102   46 C3                  DB   46h,0C3h   ;"FC"	Illegal Function Call
0104   4F D6                  DB   4Fh,0D6h   ;"OV"	Overflow.
0106   4F CD                  DB   4Fh,0CDh   ;"OM"	Out of memory.
0108   55 D3                  DB   55h,0D3h   ;"US"	Undefined Subroutine
010A   42 D3                  DB   42h,0D3h   ;"BS"	Bad Subscript
010C   44 C4                  DB   44h,0C4h   ;"DD"	Duplicate Definition
010E   2F B0                  DB   2Fh,0B0h   ;"\0"	Division by zero.
0110   49 C4                  DB   49h,0C4h   ;"ID"	Invalid in Direct mode.
0112   2C                     DB   ","   ; 
0113   00 00 00 00 00 00 00 00 LINE_BUFFER:   DW   0000,0000,0000,0000h   ;72 chars
011B   00 00 00 00 00 00 00 00 DW   0000,0000,0000,0000h   ; 
0123   00 00 00 00 00 00 00 00 DW   0000,0000,0000,0000h   ; 
012B   00 00 00 00 00 00 00 00 DW   0000,0000,0000,0000h   ; 
0133   00 00 00 00 00 00 00 00 DW   0000,0000,0000,0000h   ; 
013B   00 00 00 00 00 00 00 00 DW   0000,0000,0000,0000h   ; 
0143   00 00 00 00 00 00 00 00 DW   0000,0000,0000,0000h   ; 
014B   00 00 00 00 00 00 00 00 DW   0000,0000,0000,0000h   ; 
0153   00 00 00 00 00 00 00 00 DW   0000,0000,0000,0000h   ;		
015B   00           DIM_OR_EVAL:   DB   00h   ; 
015C   00           INPUT_OR_READ:   DB   00h   ; 
015D   00 00        PROG_PTR_TEMP:   DW   0000h   ; 
015F   00 00        TEMP2:    DW   0000h   ; 
0161   00 00        CURRENT_LINE:   DW   0000h   ; 
0163   1A 0F        STACK_TOP:   DW   STK_TOP   ; RELOCATE***
0165   00 00        PROGRAM_BASE:   DW   0000h   ; 
0167   00 00        VAR_BASE:   DW   0000h   ; 
0169   00 00        VAR_ARRAY_BASE:   DW   0000h   ; 
016B   00 00        VAR_TOP:   DW   0000h   ; 
016D   00 00        DATA_PROG_PTR:   DW   0000h   ; 
016F   00 00 00 00  FACCUM:   DB   00,00,00,00h   ; 
0173   00           FTEMP:    DB   00h   ; 
0174   00 00 00 00 00 00 FBUFFER:   DW   0000,0000,0000   
017A   00 00 00 00 00 00      DW   0000,0000,0000   
0180   00                     DB   00   ; 
0181   20 45 52 52 4F D2 00 SZERROR:   DB   0x20,0x45,0x52,0x52,0x4F,0xD2,0x00   ;" ERROR\0"	
0188   20 49 4E A0 00 SZIN:   DB   0x20,0x49,0x4E,0xA0,0x00   ;" IN \0"
018D   0D 4F CB 0D 00 SZOK:   DB   0x0D,0x4F,0xCB,0x0D,0x00   ;"\rOK\r\0"	
0192   21 04 00     GETFLOWPTR:   LXI   H,0004h   ;HL=SP+4 (ie get word
0195   39                     DAD   SP   ;just past return addr)
0196   7E                     MOV   A,M   ; 
0197   23                     INX   H   ; 
0198   FE 81                  CPI   0x81   ;"FOR"?
019A   C0                     RNZ      ;Return if not "FOR"
019B   F7                     RST   6   ; RST PushNextWord	;PUSH (HL)
019C   E3                     XTHL      ;POP HL (ie HL=(HL))
019D   E7                     RST   4   ; RST CompareHLDE	;HL==DE?
019E   01 0D 00               LXI   B,000Dh   ; 
01A1   E1                     POP   H   ;Restore HL
01A2   C8                     RZ      ;Return if var ptrs match.
01A3   09                     DAD   B   ;HL+=000D
01A4   C3 96 01               JMP   GetFlowPtr+4   ;Loop
01A7   CD C3 01     COPYMEMORYUP:   CALL   CheckEnoughMem   ; 
01AA   C5                     PUSH   B   ;Exchange BC with HL.
01AB   E3                     XTHL      ; 
01AC   C1                     POP   B   ; 
01AD   E7           COPYMEMLOOP:   RST   4   ;HL==DE?
01AE   7E                     MOV   A,M   ; 
01AF   02                     STAX   B   ; 
01B0   C8                     RZ      ;Exit if DE reached.
01B1   0B                     DCX   B   ; 
01B2   2B                     DCX   H   ; 
01B3   C3 AD 01               JMP   CopyMemLoop   ; 
01B6   E5           CHECKENOUGHVARSPACE:   PUSH   H   ; 
01B7   2A 6B 01               LHLD   VAR_TOP   ; 
01BA   06 00                  MVI   B,00h   ;BC=C*4
01BC   09                     DAD   B   ; 
01BD   09                     DAD   B   ; 
01BE   CD C3 01               CALL   CheckEnoughMem   ; 
01C1   E1                     POP   H   ; 
01C2   C9                     RET      ; 
01C3   D5           CHECKENOUGHMEM:   PUSH   D   ; 
01C4   EB                     XCHG      ; 
01C5   21 DE FF               LXI   H,0xFFDE   ;HL=-34 (extra 2 bytes for return address)
01C8   39                     DAD   SP   ; 
01C9   E7                     RST   4   ; 
01CA   EB                     XCHG      ; 
01CB   D1                     POP   D   ; 
01CC   D0                     RNC      ; 
01CD   1E 0C        OUTOFMEMORY:   MVI   E,0Ch   ; 
01CF   01                     DB   01   ;LXI B,....	;
01D0   1E 02        SYNTAXERROR:   MVI   E,02h   ; 
01D2   01                     DB   01   ;LXI B,....	;
01D3   1E 14        DIVIDEBYZERO:   MVI   E,14h   ; 
01D5   CD B5 02     ERROR:    CALL   ResetStack   ; 
01D8   CD 98 05               CALL   NewLine   ; 
01DB   21 FA 00               LXI   H,ERROR_CODES   ; 
01DE   57                     MOV   D,A   ; 
01DF   3E 3F                  MVI   A,"?"   ;Print "?"
01E1   DF                     RST   03   ;RST OutChar	;
01E2   19                     DAD   D   ;HL points to error code.
01E3   7E                     MOV   A,M   ; 
01E4   DF                     RST   03   ;RST OutChar 11 011 111	;Print first char of code.
01E5   D7                     RST   02   ;RST NextChar 11 010 111	;
01E6   DF                     RST   03   ;RST OutChar	;Print second char of code.
01E7   21 81 01               LXI   H,szError   ;Print " ERROR".
01EA   CD A7 05               CALL   PrintString   ; 
01ED   2A 61 01               LHLD   CURRENT_LINE   ; 
01F0   7C                     MOV   A,H   ; 
01F1   A5                     ANA   L   ; 
01F2   3C                     INR   A   ; 
01F3   C4 33 0B               CNZ   PrintIN   ; 
01F6   01                     DB   01   ;LXI B,....	;LXI over Stop and fall into Main
01F7   C0           STOP:     RNZ      ;Syntax Error if args.
01F8   C1                     POP   B   ;Lose return address.
01F9   21 8D 01     MAIN:     LXI   H,szOK   ; 
01FC   CD 25 0D               CALL   Init   ; 
01FF   21 FF FF     GETNONBLANKLINE:   LXI   H,0xFFFF   ; 
0202   22 61 01               SHLD   CURRENT_LINE   ; 
0205   CD 3C 03               CALL   InputLine   ; 
0208   D7                     RST   02   ;RST NextChar	;
0209   3C                     INR   A   ; 
020A   3D                     DCR   A   ; 
020B   CA FF 01               JZ   GetNonBlankLine   ; 
020E   F5                     PUSH   PSW   
020F   CD AB 04               CALL   LineNumberFromStr   
0212   D5                     PUSH   D   
0213   CD CC 02               CALL   Tokenize   
0216   47                     MOV   B,A   
0217   D1                     POP   D   
0218   F1                     POP   PSW   
0219   D2 48 04               JNC   Exec   
021C   D5           STOREPROGRAMLINE:   PUSH   D   ;Push line number
021D   C5                     PUSH   B   ;Push line length
021E   D7                     RST   02   ;RST NextChar	;Get first char of line
021F   B7                     ORA   A   ;Zero set if line is empty (ie removing a line)
0220   F5                     PUSH   PSW   ;Preserve line-empty flag
0221   CD 7D 02               CALL   FindProgramLine   ;Get nearest program line address in BC.
0224   C5                     PUSH   B   ;Push line address.
0225   D2 39 02               JNC   InsertProgramLine   ;If line doesn't exist, jump ahead to insert it.
0228   EB           REMOVEPROGRAMLINE:   XCHG      ;DE=Next line address.
0229   2A 67 01               LHLD   VAR_BASE   ; 
022C   1A           REMOVELINE:   LDAX   D   ;Move byte of program remainder down
022D   02                     STAX   B   ;in memory.
022E   03                     INX   B   ; 
022F   13                     INX   D   ; 
0230   E7                     RST   4   ;Loop until DE==VAR_BASE, ie whole
0231   C2 2C 02               JNZ   RemoveLine   ;program remainder done.
0234   60                     MOV   H,B   ; 
0235   69                     MOV   L,C   ;Update VAR_BASE from BC.
0236   22 67 01               SHLD   VAR_BASE   ; 
0239   D1           INSERTPROGRAMLINE:   POP   D   ;DE=Line address (from 224)
023A   F1                     POP   PSW   ;Restore line-empty flag (see above)
023B   CA 60 02               JZ   UpdateLinkedList   ;If line is empty, then we don't need to insert it so can jump ahead.
023E   2A 67 01               LHLD   VAR_BASE   ; 
0241   E3                     XTHL      ;HL = Line length (see 21D)
0242   C1                     POP   B   ;BC = VAR_BASE
0243   09                     DAD   B   ;HL = VAR_BASE + line length.
0244   E5                     PUSH   H   ; 
0245   CD A7 01               CALL   CopyMemoryUp   ;Move remainder of program so there's enough space for the new line.
0248   E1                     POP   H   ; 
0249   22 67 01               SHLD   VAR_BASE   ;Update VAR_BASE
024C   EB                     XCHG      ;HL=Line address, DE=VAR_BASE
024D   74                     MOV   M,H   ;???
024E   23                     INX   H   ;Skip over next line ptr (updated below)
024F   23                     INX   H   ; 
0250   D1                     POP   D   ;DE = line number (see 21C)
0251   73                     MOV   M,E   ;Write line number to program line memory.
0252   23                     INX   H   ; 
0253   72                     MOV   M,D   ; 
0254   23                     INX   H   ; 
0255   11 13 01     COPYFROMBUFFER:   LXI   D,LINE_BUFFER   ;Copy the line into the program.
0258   1A                     LDAX   D   ; 
0259   77                     MOV   M,A   ; 
025A   23                     INX   H   ; 
025B   13                     INX   D   ; 
025C   B7                     ORA   A   ; 
025D   C2 58 02               JNZ   CopyFromBuffer+3   ; 
0260   CD A2 02     UPDATELINKEDLIST:   CALL   ResetAll   ; 
0263   23                     INX   H   ; 
0264   EB                     XCHG      ; 
0265   62           L0265:    MOV   H,D   ; 
0266   6B                     MOV   L,E   ; 
0267   7E                     MOV   A,M   ;If the pointer to the next line is a null
0268   23                     INX   H   ;word then we've reached the end of the
0269   B6                     ORA   M   ;program, job is done, and we can jump back
026A   CA FF 01               JZ   GetNonBlankLine   ;to let the user type in the next line.
026D   23                     INX   H   ;Skip over line number.
026E   23                     INX   H   ; 
026F   23                     INX   H   ; 
0270   AF                     XRA   A   ; 
0271   BE           L0271:    CMP   M   ; 
0272   23                     INX   H   ; 
0273   C2 71 02               JNZ   L0271   ; 
0276   EB                     XCHG      ; 
0277   73                     MOV   M,E   ; 
0278   23                     INX   H   ; 
0279   72                     MOV   M,D   ; 
027A   C3 65 02               JMP   L0265   ; 
027D   2A 65 01     FINDPROGRAMLINE:   LHLD   PROGRAM_BASE   ; 
0280   44                     MOV   B,H   ;BC=this line
0281   4D                     MOV   C,L   ; 
0282   7E                     MOV   A,M   ;If we've found two consecutive
0283   23                     INX   H   ;null bytes, then we've reached the end
0284   B6                     ORA   M   ;of the program and so return.
0285   2B                     DCX   H   ; 
0286   C8                     RZ      ; 
0287   C5                     PUSH   B   ;Push this line address
0288   F7                     RST   6   ;Push (next line address)
0289   F7                     RST   6   ;Push (this line number)
028A   E1                     POP   H   ;HL = this line number
028B   E7                     RST   4   ;Compare line numbers
028C   E1                     POP   H   ;HL = next line address
028D   C1                     POP   B   ;BC = this line address
028E   3F                     CMC      ; 
028F   C8                     RZ      ;Return carry set if line numbers match.
0290   3F                     CMC      ; 
0291   D0                     RNC      ;Return if we've reached a line number greater than the one required.
0292   C3 80 02               JMP   FindProgramLine+3   
0295   C0           NEW:      RNZ      
0296   2A 65 01               LHLD   PROGRAM_BASE   
0299   AF                     XRA   A   
029A   77                     MOV   M,A   
029B   23                     INX   H   
029C   77                     MOV   M,A   
029D   23                     INX   H   
029E   22 67 01               SHLD   VAR_BASE   
02A1   C0           RUN:      RNZ      
02A2   2A 65 01     RESETALL:   LHLD   PROGRAM_BASE   
02A5   2B                     DCX   H   
02A6   22 5D 01     CLEAR:    SHLD   PROG_PTR_TEMP   
02A9   CD 73 04               CALL   Restore   
02AC   2A 67 01               LHLD   VAR_BASE   
02AF   22 69 01               SHLD   VAR_ARRAY_BASE   
02B2   22 6B 01               SHLD   VAR_TOP   
02B5   C1           RESETSTACK:   POP   B   
02B6   2A 63 01               LHLD   STACK_TOP   
02B9   F9                     SPHL      
02BA   AF                     XRA   A   
02BB   6F                     MOV   L,A   
02BC   E5                     PUSH   H   
02BD   C5                     PUSH   B   
02BE   2A 5D 01               LHLD   PROG_PTR_TEMP   
02C1   C9                     RET      
02C2   3E 3F        INPUTLINEWITH:   MVI   A,"?"   ;Print "?"
02C4   DF                     RST   03   ;RST OutChar	;
02C5   3E 20                  MVI   A," "   ;Print " "
02C7   DF                     RST   03   ;RST OutChar	;
02C8   CD 3C 03               CALL   InputLine   ; 
02CB   23                     INX   H   ; 
02CC   0E 05        TOKENIZE:   MVI   C,05   ;Initialise line length to 5.
02CE   11 13 01               LXI   D,LINE_BUFFER   ;ie, output ptr is same as input ptr at start.
02D1   7E                     MOV   A,M   ; 
02D2   FE 20                  CPI   " "   ; 
02D4   CA 02 03               JZ   WriteChar   ; 
02D7   47                     MOV   B,A   ; 
02D8   FE 22                  CPI   0x22   ;"""	;
02DA   CA 15 03               JZ   FreeCopy   ; 
02DD   B7                     ORA   A   ; 
02DE   CA 29 03               JZ   Exit   ; 
02E1   D5                     PUSH   D   ;Preserve output ptr.
02E2   06 00                  MVI   B,00   ;Initialise Keyword ID to 0.
02E4   11 56 00               LXI   D,KEYWORDS-1   ; 
02E7   E5                     PUSH   H   ;Preserve input ptr.
02E8   3E                     DB   3Eh   ;LXI over get-next-char
02E9   D7           KWCOMPARE:   RST   02   ; RST 01	; SyntaxCheck0	;Get next input char
02EA   13                     INX   D   ; 
02EB   1A                     LDAX   D   ;Get keyword char to compare with.
02EC   E6 7F                  ANI   7Fh   ;Ignore bit 7 of keyword char.
02EE   CA FF 02               JZ   NotAKeyword   ;If keyword char==0, then end of keywords reached.
02F1   BE                     CMP   M   ;Keyword char matches input char?
02F2   C2 1C 03               JNZ   NextKeyword   ;If not, jump to get next keyword.
02F5   1A                     LDAX   D   ; 
02F6   B7                     ORA   A   ; 
02F7   F2 E9 02               JP   KwCompare   ; 
02FA   F1                     POP   PSW   ;Remove input ptr from stack. We don't need it.
02FB   78                     MOV   A,B   ;A=Keyword ID
02FC   F6 80                  ORI   0x80   ;Set bit 7 (indicates a keyword)
02FE   F2                     DB   0xF2   ;JP ....	;LXI trick again.
02FF   E1           NOTAKEYWORD:   POP   H   ;Restore input ptr
0300   7E                     MOV   A,M   ;and get input char
0301   D1                     POP   D   ;Restore output ptr
0302   23           WRITECHAR:   INX   H   ;Advance input ptr
0303   12                     STAX   D   ;Store output char
0304   13                     INX   D   ;Advance output ptr
0305   0C                     INR   C   ;C++ (arf!).
0306   D6 8E                  SUI   8Eh   ;If it's not the
0308   C2 D1 02               JNZ   Tokenize+5   ; 
030B   47                     MOV   B,A   ;B=0
030C   7E           FREECOPYLOOP:   MOV   A,M   ;A=Input char
030D   B7                     ORA   A   ;If char is null then exit
030E   CA 29 03               JZ   Exit   ; 
0311   B8                     CMP   B   ;If input char is term char then
0312   CA 02 03               JZ   WriteChar   ;we're done free copying.
0315   23           FREECOPY:   INX   H   ; 
0316   12                     STAX   D   ; 
0317   0C                     INR   C   ; 
0318   13                     INX   D   ; 
0319   C3 0C 03               JMP   FreeCopyLoop   ; 
031C   E1           NEXTKEYWORD:   POP   H   ;Restore input ptr
031D   E5                     PUSH   H   ; 
031E   04                     INR   B   ;Keyword ID ++;
031F   EB                     XCHG      ;HL=keyword table ptr
0320   B6           NEXTKWLOOP:   ORA   M   ;Loop until
0321   23                     INX   H   ;bit 7 of previous
0322   F2 20 03               JP   NextKwLoop   ;keyword char is set.
0325   EB                     XCHG      ;DE=keyword ptr, HL=input ptr
0326   C3 EB 02               JMP   KwCompare+2   ; 
0329   21 12 01     EXIT:     LXI   H,LINE_BUFFER-1   ; 
032C   12                     STAX   D   ; 
032D   13                     INX   D   ; 
032E   12                     STAX   D   ; 
032F   13                     INX   D   ; 
0330   12                     STAX   D   ; 
0331   C9                     RET      ; 
0332   05           BACKSPACE:   DCR   B   ;Char count--;
0333   2B                     DCX   H   ;Input ptr--;
0334   DF                     RST   03   ;RST OutChar	;Print backspace char.
0335   C2 41 03               JNZ   InputNext   ; 
0338   DF           RESETINPUT:   RST   03   ;RST OutChar	;
0339   CD 98 05               CALL   NewLine   ; 
033C   21 13 01     INPUTLINE:   LXI   H,LINE_BUFFER   ; 
033F   06 01                  MVI   B,01   ; 
0341   CD 88 03     INPUTNEXT:   CALL   InputChar   ; 
0344   FE 0D                  CPI   0x0D   ; 
0346   CA 93 05               JZ   TerminateInput   ; 
0349   FE 20                  CPI   " "   ;If < " "
034B   DA 41 03               JC   InputNext   ;or
034E   FE 7D                  CPI   0x7D   ;> "}"
0350   D2 41 03               JNC   InputNext   ;then loop back.
0353   FE 40                  CPI   "@"   ; 
0355   CA 38 03               JZ   ResetInput   ; 
0358   FE 5F                  CPI   "_"   ; 
035A   CA 32 03               JZ   Backspace   ; 
035D   4F                     MOV   C,A   ; 
035E   78                     MOV   A,B   ; 
035F   FE 48                  CPI   0x48   ; 
0361   3E 07                  MVI   A,07   ; 
0363   D2 6A 03               JNC   L036A   ; 
0366   79                     MOV   A,C   ;Write char to LINE_BUFFER.
0367   71                     MOV   M,C   ; 
0368   23                     INX   H   ; 
0369   04                     INR   B   ; 
036A   DF           L036A:    RST   03   ;RST OutChar	;
036B   C3 41 03               JMP   InputNext   ; 
036E   FE 48        OUTCHAR_TAIL:   CPI   0x48   ; 
0370   CC 98 05               CZ   NewLine   ; 
0373   3C                     INR   A   ; 
0374   32 27 00               STA   TERMINAL_X   ; 
0377   3E 00        WAITTERMREADY:   MVI   A,0   
0379   D3 19                  OUT   UART_TX_STATUS   ; select RR0
037B   DB 19                  IN   UART_TX_STATUS   ; in a,(UART_TX_STATUS)	; status register of serial port
037D   E6 04                  ANI   UART_TX_EMPTY   ; and UART_TX_EMPTY		; wait for tx buffer empty
037F   CA 77 03               JZ   WaitTermReady   ; 
0382   F1                     POP   PSW   ; pop AF			; get byte to be sent
0383   E6 7F                  ANI   7Fh   ; and 7fh			; strip MSB
0385   D3 18                  OUT   UART_TX   ; out (UART_TX),a		; serial port TX buffer
0387   C9                     RET      ; 
0388   3E 00        INPUTCHAR:   MVI   A,0   
038A   D3 19                  OUT   UART_RX_STATUS   ; select RR0
038C   DB 19                  IN   UART_RX_STATUS   ; in a,(UART_RX_STATUS)	; status register of serial port
038E   E6 01                  ANI   UART_RX_FULL   ; and UART_RX_FULL	; wait for RX buffer full
0390   CA 88 03               JZ   InputChar   ; 
0393   DB 18                  IN   UART_RX   ; in a,(UART_RX)	; fetch received char
0395   E6 7F                  ANI   7Fh   ; and 7fh			; strip MSB
0397   C9                     RET      ; 
0398   CD AB 04     LIST:     CALL   LineNumberFromStr   
039B   C0                     RNZ      
039C   C1                     POP   B   ;?why get return address?
039D   CD 7D 02               CALL   FindProgramLine   
03A0   C5                     PUSH   B   
03A1   E1           LISTNEXTLINE:   POP   H   
03A2   F7                     RST   6   
03A3   C1                     POP   B   
03A4   78                     MOV   A,B   
03A5   B1                     ORA   C   
03A6   CA F9 01               JZ   Main   
03A9   CD 7D 04               CALL   TestBreakKey   
03AC   C5                     PUSH   B   
03AD   CD 98 05               CALL   NewLine   
03B0   F7                     RST   6   
03B1   E3                     XTHL      
03B2   CD 3B 0B               CALL   PrintInt   
03B5   3E 20                  MVI   A," "   
03B7   E1                     POP   H   
03B8   DF           LISTCHAR:   RST   03   ;RST OutChar	
03B9   7E                     MOV   A,M   
03BA   B7                     ORA   A   
03BB   23                     INX   H   
03BC   CA A1 03               JZ   ListNextLine   
03BF   F2 B8 03               JP   ListChar   
03C2   D6 7F                  SUI   7Fh   ;A is now keyword index + 1.
03C4   4F                     MOV   C,A   
03C5   E5                     PUSH   H   
03C6   11 57 00               LXI   D,KEYWORDS   
03C9   D5                     PUSH   D   
03CA   1A           TONEXTKEYWORD:   LDAX   D   
03CB   13                     INX   D   
03CC   B7                     ORA   A   
03CD   F2 CA 03               JP   ToNextKeyword   
03D0   0D                     DCR   C   
03D1   E1                     POP   H   
03D2   C2 C9 03               JNZ   ToNextKeyword-1   
03D5   7E           PRINTKEYWORD:   MOV   A,M   
03D6   B7                     ORA   A   
03D7   FA B7 03               JM   ListChar-1   
03DA   DF                     RST   03   ;RST OutChar	
03DB   23                     INX   H   
03DC   C3 D5 03               JMP   PrintKeyword   
03DF   CD 10 05     FOR:      CALL   Let   
03E2   E3                     XTHL      
03E3   CD 92 01               CALL   GetFlowPtr   
03E6   D1                     POP   D   
03E7   C2 EC 03               JNZ   L03E2   
03EA   09                     DAD   B   
03EB   F9                     SPHL      
03EC   EB           L03E2:    XCHG      
03ED   0E 08                  MVI   C,08   
03EF   CD B6 01               CALL   CheckEnoughVarSpace   
03F2   E5                     PUSH   H   
03F3   CD 03 05               CALL   FindNextStatement   
03F6   E3                     XTHL      
03F7   E5                     PUSH   H   
03F8   2A 61 01               LHLD   CURRENT_LINE   
03FB   E3                     XTHL      
03FC   CF                     RST   01   ; SyntaxCheck; SyntaxCheck	
03FD   95                     DB   95h   ;KWID_TO	
03FE   CD 8E 06               CALL   EvalExpression   
0401   E5                     PUSH   H   
0402   CD 21 0A               CALL   FCopyToBCDE   
0405   E1                     POP   H   
0406   C5                     PUSH   B   
0407   D5                     PUSH   D   
0408   01 00 81               LXI   B,8100h   
040B   51                     MOV   D,C   
040C   5A                     MOV   E,D   
040D   7E                     MOV   A,M   
040E   FE 97                  CPI   0x97   ;KWID_STEP	
0410   3E 01                  MVI   A,01h   
0412   C2 1E 04               JNZ   PushStepValue   
0415   CD 8F 06               CALL   EvalExpression+1   
0418   E5                     PUSH   H   
0419   CD 21 0A               CALL   FCopyToBCDE   
041C   EF                     RST   05   ; FTestSign	
041D   E1                     POP   H   
041E   C5           PUSHSTEPVALUE:   PUSH   B   
041F   D5                     PUSH   D   
0420   F5                     PUSH   PSW   
0421   33                     INX   SP   
0422   E5                     PUSH   H   
0423   2A 5D 01               LHLD   PROG_PTR_TEMP   
0426   E3                     XTHL      
0427   06 81        ENDOFFORHANDLER:   MVI   B,0x81   
0429   C5                     PUSH   B   
042A   33                     INX   SP   
042B   CD 7D 04     EXECNEXT:   CALL   TestBreakKey   
042E   7E                     MOV   A,M   
042F   FE 3A                  CPI   ":"   
0431   CA 48 04               JZ   Exec   
0434   B7                     ORA   A   
0435   C2 D0 01               JNZ   SyntaxError   
0438   23                     INX   H   
0439   7E                     MOV   A,M   
043A   23                     INX   H   
043B   B6                     ORA   M   
043C   23                     INX   H   
043D   CA F9 01               JZ   Main   
0440   5E                     MOV   E,M   
0441   23                     INX   H   
0442   56                     MOV   D,M   
0443   EB                     XCHG      
0444   22 61 01               SHLD   CURRENT_LINE   
0447   EB                     XCHG      
0448   D7           EXEC:     RST   02   ;RST NextChar	
0449   11 2B 04               LXI   D,ExecNext   
044C   D5                     PUSH   D   
044D   C8                     RZ      
044E   D6 80                  SUI   80h   
0450   DA 10 05               JC   Let   
0453   FE 14                  CPI   0x14   
0455   D2 D0 01               JNC   SyntaxError   
0458   07                     RLC      ;BC = A*2
0459   4F                     MOV   C,A   
045A   06 00                  MVI   B,00h   
045C   EB                     XCHG      
045D   21 D2 00               LXI   H,KW_GENERAL_FNS   
0460   09                     DAD   B   
0461   4E                     MOV   C,M   
0462   23                     INX   H   
0463   46                     MOV   B,M   
0464   C5                     PUSH   B   
0465   EB                     XCHG      
0466   D7                     RST   02   ;RST NextChar	
0467   C9                     RET      
0468   FE 20        NEXTCHAR_TAIL:   CPI   " "   
046A   CA 10 00               JZ   NextChar   
046D   FE 30                  CPI   "0"   
046F   3F                     CMC      
0470   3C                     INR   A   
0471   3D                     DCR   A   
0472   C9                     RET      
0473   EB           RESTORE:   XCHG      
0474   2A 65 01               LHLD   PROGRAM_BASE   
0477   2B                     DCX   H   
0478   22 6D 01     L046E:    SHLD   DATA_PROG_PTR   
047B   EB                     XCHG      
047C   C9                     RET      
047D   3E 00        TESTBREAKKEY:   MVI   A,0   
047F   D3 19                  OUT   UART_RX_STATUS   ; select RR0
0481   DB 19                  IN   UART_RX_STATUS   ; in a,(00)		; status register of serial port
0483   E6 01                  ANI   UART_RX_FULL   ; and 1			; wait for RX buffer full
0485   C8                     RZ      ;Exit if no key pressed.
0486   CD 88 03               CALL   InputChar   ; 
0489   FE 03                  CPI   0x03   ;Break key?
048B   C3 F7 01               JMP   Stop   
048E   7E           CHARISALPHA:   MOV   A,M   
048F   FE 41                  CPI   "A"   
0491   D8                     RC      
0492   FE 5B                  CPI   "Z"+1   
0494   3F                     CMC      
0495   C9                     RET      
0496   D7           GETSUBSCRIPT:   RST   02   ;RST NextChar	
0497   CD 8E 06               CALL   EvalExpression   
049A   EF                     RST   05   ; FTestSign	
049B   FA A6 04               JM   FunctionCallError   
049E   3A 72 01               LDA   FACCUM+3   
04A1   FE 90                  CPI   0x90   
04A3   DA 7B 0A               JC   FAsInteger   
04A6   1E 08        FUNCTIONCALLERROR:   MVI   E,08h   
04A8   C3 D5 01               JMP   Error   
04AB   2B           LINENUMBERFROMSTR:   DCX   H   
04AC   11 00 00               LXI   D,0000   
04AF   D7           NEXTLINENUMCHAR:   RST   02   ;RST NextChar	
04B0   D0                     RNC      
04B1   E5                     PUSH   H   
04B2   F5                     PUSH   PSW   ;Preserve flags
04B3   21 98 19               LXI   H,1998h   ;Decimal 6552
04B6   E7                     RST   4   
04B7   DA D0 01               JC   SyntaxError   
04BA   62                     MOV   H,D   
04BB   6B                     MOV   L,E   
04BC   19                     DAD   D   
04BD   29                     DAD   H   
04BE   19                     DAD   D   
04BF   29                     DAD   H   
04C0   F1                     POP   PSW   
04C1   D6 30                  SUI   "0"   
04C3   5F                     MOV   E,A   
04C4   16 00                  MVI   D,00h   
04C6   19                     DAD   D   
04C7   EB                     XCHG      
04C8   E1                     POP   H   
04C9   C3 AF 04               JMP   NextLineNumChar   
04CC   0E 03        GOSUB:    MVI   C,03h   
04CE   CD B6 01               CALL   CheckEnoughVarSpace   
04D1   C1                     POP   B   
04D2   E5                     PUSH   H   
04D3   E5                     PUSH   H   
04D4   2A 61 01               LHLD   CURRENT_LINE   
04D7   E3                     XTHL      
04D8   16 8C                  MVI   D,0x8C   
04DA   D5                     PUSH   D   
04DB   33                     INX   SP   
04DC   C5                     PUSH   B   
04DD   CD AB 04     GOTO:     CALL   LineNumberFromStr   
04E0   C0                     RNZ      
04E1   CD 7D 02               CALL   FindProgramLine   
04E4   60                     MOV   H,B   
04E5   69                     MOV   L,C   
04E6   2B                     DCX   H   
04E7   D8                     RC      
04E8   1E 0E                  MVI   E,0Eh   
04EA   C3 D5 01               JMP   Error   
04ED   C0           RETURN:   RNZ      
04EE   16 FF                  MVI   D,0xFF   
04F0   CD 92 01               CALL   GetFlowPtr   
04F3   F9                     SPHL      
04F4   FE 8C                  CPI   0x8C   
04F6   1E 04                  MVI   E,04h   
04F8   C2 D5 01               JNZ   Error   
04FB   E1                     POP   H   
04FC   22 61 01               SHLD   CURRENT_LINE   
04FF   21 2B 04               LXI   H,ExecNext   
0502   E3                     XTHL      
0503   01 3A        FINDNEXTSTATEMENT:   DB   01h,3Ah   ;LXI B,..3A	
0505   10           REM:      DB   10h   
0506   00                     NOP      
0507   7E           FINDNEXTSTATEMENTLOOP:   MOV   A,M   
0508   B7                     ORA   A   
0509   C8                     RZ      
050A   B9                     CMP   C   
050B   C8                     RZ      
050C   23                     INX   H   
050D   C3 07 05               JMP   FindNextStatementLoop   
0510   CD 1F 07     LET:      CALL   GetVar   
0513   CF                     RST   01   ; SyntaxCheck	
0514   9D                     DB   9Dh   
0515   D5           ASSIGNVAR:   PUSH   D   
0516   CD 8E 06               CALL   EvalExpression   
0519   E3                     XTHL      
051A   22 5D 01               SHLD   PROG_PTR_TEMP   
051D   E5                     PUSH   H   
051E   CD 2D 0A               CALL   FCopyToMem   
0521   D1                     POP   D   
0522   E1                     POP   H   
0523   C9                     RET      
0524   CD 8E 06     IFL:      CALL   EvalExpression   
0527   7E                     MOV   A,M   
0528   CD 06 0A               CALL   FPush   
052B   16 00                  MVI   D,00   
052D   D6 9C        GETCOMPAREOPLOOP:   SUI   9Ch   ; KWID_>	
052F   DA 40 05               JC   GotCompareOp   
0532   FE 03                  CPI   0x03   
0534   D2 40 05               JNC   GotCompareOp   
0537   FE 01                  CPI   0x01   
0539   17                     RAL      
053A   B2                     ORA   D   
053B   57                     MOV   D,A   
053C   D7                     RST   02   ;RST NextChar	
053D   C3 2D 05               JMP   GetCompareOpLoop   
0540   7A           GOTCOMPAREOP:   MOV   A,D   
0541   B7                     ORA   A   
0542   CA D0 01               JZ   SyntaxError   
0545   F5                     PUSH   PSW   
0546   CD 8E 06               CALL   EvalExpression   
0549   CF                     RST   01   ; SyntaxCheck	
054A   96                     DB   96h   ;KWID_THEN	
054B   2B                     DCX   H   
054C   F1                     POP   PSW   
054D   C1                     POP   B   
054E   D1                     POP   D   
054F   E5                     PUSH   H   
0550   F5                     PUSH   PSW   
0551   CD 50 0A               CALL   FCompare   
0554   3C                     INR   A   
0555   17                     RAL      
0556   C1                     POP   B   
0557   A0                     ANA   B   
0558   E1                     POP   H   
0559   CA 05 05               JZ   Rem   
055C   D7                     RST   02   ;RST NextChar	
055D   DA DD 04               JC   Goto   
0560   C3 4D 04               JMP   Exec+5   
0563   2B                     DCX   H   
0564   D7                     RST   02   ;RST NextChar	
0565   CA 98 05     PRINT:    JZ   NewLine   
0568   C8                     RZ      
0569   FE 22                  CPI   0x22   ;"""	
056B   CC A6 05               CZ   PrintString-1   
056E   CA 63 05               JZ   Print-2   
0571   FE 94                  CPI   0x94   ;KWID_TAB	
0573   CA CB 05               JZ   Tab   
0576   E5                     PUSH   H   
0577   FE 2C                  CPI   ","   
0579   CA B7 05               JZ   ToNextTabBreak   
057C   FE 3B                  CPI   0x3B   ; ";"	
057E   CA E3 05               JZ   ExitTab   
0581   C1                     POP   B   
0582   CD 8E 06               CALL   EvalExpression   
0585   E5                     PUSH   H   
0586   CD 46 0B               CALL   FOut   
0589   CD A7 05               CALL   PrintString   
058C   3E 20                  MVI   A," "   
058E   DF                     RST   03   ;RST OutChar	
058F   E1                     POP   H   
0590   C3 63 05               JMP   Print-2   
0593   36 00        TERMINATEINPUT:   MVI   M,00h   
0595   21 12 01               LXI   H,LINE_BUFFER-1   
0598   3E 0D        NEWLINE:   MVI   A,0Dh   
059A   32 27 00               STA   TERMINAL_X   
059D   DF                     RST   03   ;RST OutChar	
059E   3E 0A                  MVI   A,0Ah   
05A0   DF                     RST   03   ;RST OutChar	
05A1                             ; from BASIC.asm, https://github.com/bhall66/IMSAI-8080/tree/main/Altair-Basic
05A1   AF                     XRA   A   
05A2   32 27 00               STA   TERMINAL_X   ; reset x posn
05A5   C9                     RET      ; returns with A=0
05A6                             ; the rest of this routine is ALTAIR and/or teletype specific, and not needed
05A6                             ;	LDA TERMINAL_Y	
05A6                             ;PrintNullLoop	DCR A	
05A6                             ;	STA TERMINAL_X	
05A6                             ;	RZ	
05A6                             ;	PUSH PSW	
05A6                             ;	XRA A	
05A6                             ;	RST 03	;RST OutChar	
05A6                             ;	POP PSW	
05A6                             ;	JMP PrintNullLoop	
05A6   23                     INX   H   
05A7   7E           PRINTSTRING:   MOV   A,M   
05A8   B7                     ORA   A   
05A9   C8                     RZ      
05AA   23                     INX   H   
05AB   FE 22                  CPI   0x22   ;"""	
05AD   C8                     RZ      
05AE   DF                     RST   03   ;RST OutChar	
05AF   FE 0D                  CPI   0x0D   
05B1   CC 98 05               CZ   NewLine   
05B4   C3 A7 05               JMP   PrintString   
05B7   3A 27 00     TONEXTTABBREAK:   LDA   TERMINAL_X   
05BA   FE 38                  CPI   0x38   
05BC   D4 98 05               CNC   NewLine   
05BF   D2 E3 05               JNC   ExitTab   
05C2   D6 0E        CALCSPACECOUNT:   SUI   0Eh   
05C4   D2 C2 05               JNC   CalcSpaceCount   
05C7   2F                     CMA      
05C8   C3 DA 05               JMP   PrintSpaces   
05CB   CD 96 04     TAB:      CALL   GetSubscript   
05CE   CF                     RST   01   ; SyntaxCheck	
05CF   29                     DB   29h   ;")"	
05D0   2B                     DCX   H   
05D1   E5                     PUSH   H   
05D2   3A 27 00               LDA   TERMINAL_X   
05D5   2F                     CMA      
05D6   83                     ADD   E   
05D7   D2 E3 05               JNC   ExitTab   
05DA   3C           PRINTSPACES:   INR   A   
05DB   47                     MOV   B,A   
05DC   3E 20                  MVI   A," "   
05DE   DF           PRINTSPACELOOP:   RST   03   ;RST OutChar	
05DF   05                     DCR   B   
05E0   C2 DE 05               JNZ   PrintSpaceLoop   
05E3   E1           EXITTAB:   POP   H   
05E4   D7                     RST   02   ;RST NextChar	
05E5   C3 68 05               JMP   Print+3   
05E8   E5           INPUT:    PUSH   H   
05E9   2A 61 01               LHLD   CURRENT_LINE   
05EC   1E 16                  MVI   E,16h   
05EE   23                     INX   H   
05EF   7D                     MOV   A,L   
05F0   B4                     ORA   H   
05F1   CA D5 01               JZ   Error   
05F4   CD C2 02               CALL   InputLineWith   
05F7   C3 FF 05               JMP   L05FA+1   
05FA   E5           READ:     PUSH   H   
05FB   2A 6D 01               LHLD   DATA_PROG_PTR   
05FE   F6 AF        L05FA:    ORI   0xAF   
0600                             ;XRA A	
0600   32 5C 01               STA   INPUT_OR_READ   
0603   E3                     XTHL      
0604   01                     DB   01   ;LXI B,....	
0605   CF           READNEXT:   RST   01   ; SyntaxCheck	
0606   2C                     DB   2Ch   ;","	
0607   CD 1F 07               CALL   GetVar   
060A   E3                     XTHL      
060B   D5                     PUSH   D   
060C   7E                     MOV   A,M   
060D   FE 2C                  CPI   ","   
060F   CA 24 06               JZ   GotDataItem   
0612   B7                     ORA   A   
0613   C2 D0 01               JNZ   SyntaxError   
0616   3A 5C 01               LDA   INPUT_OR_READ   
0619   B7                     ORA   A   
061A   23                     INX   H   
061B   C2 3A 06               JNZ   NextDataLine+1   
061E   3E 3F                  MVI   A,"?"   
0620   DF                     RST   03   ;RST OutChar	
0621   CD C2 02               CALL   InputLineWith   
0624   D1           GOTDATAITEM:   POP   D   
0625   23                     INX   H   
0626   CD 15 05               CALL   AssignVar   
0629   E3                     XTHL      
062A   2B                     DCX   H   
062B   D7                     RST   02   ;RST NextChar	
062C   C2 05 06               JNZ   ReadNext   
062F   D1                     POP   D   
0630   3A 5C 01               LDA   INPUT_OR_READ   
0633   B7                     ORA   A   
0634   C8                     RZ      
0635   EB                     XCHG      
0636   C2 78 04               JNZ   L046E   
0639   E1           NEXTDATALINE:   POP   H   
063A   F7                     RST   6   
063B   79                     MOV   A,C   
063C   B0                     ORA   B   
063D   1E 06                  MVI   E,06h   
063F   CA D5 01               JZ   Error   
0642   23                     INX   H   
0643   D7                     RST   02   ;RST NextChar	
0644   FE 83                  CPI   0x83   ;KWID_DATA	
0646   C2 39 06               JNZ   NextDataLine   
0649   C1                     POP   B   
064A   C3 24 06               JMP   GotDataItem   
064D   CD 1F 07     NEXT:     CALL   GetVar   
0650   22 5D 01               SHLD   PROG_PTR_TEMP   
0653   CD 92 01               CALL   GetFlowPtr   
0656   F9                     SPHL      
0657   D5                     PUSH   D   
0658   7E                     MOV   A,M   
0659   23                     INX   H   
065A   F5                     PUSH   PSW   
065B   D5                     PUSH   D   
065C   1E 00                  MVI   E,00h   
065E   C2 D5 01               JNZ   Error   
0661   CD 13 0A               CALL   FLoadFromMem   
0664   E3                     XTHL      
0665   E5                     PUSH   H   
0666   CD 08 08               CALL   FAddMem   
0669   E1                     POP   H   
066A   CD 2D 0A               CALL   FCopyToMem   
066D   E1                     POP   H   
066E   CD 24 0A               CALL   FLoadBCDEfromMem   
0671   E5                     PUSH   H   
0672   CD 50 0A               CALL   FCompare   
0675   E1                     POP   H   
0676   C1                     POP   B   
0677   90                     SUB   B   
0678   CD 24 0A               CALL   FLoadBCDEfromMem   
067B   CA 87 06               JZ   ForLoopIsComplete   
067E   EB                     XCHG      
067F   22 61 01               SHLD   CURRENT_LINE   
0682   69                     MOV   L,C   
0683   60                     MOV   H,B   
0684   C3 27 04               JMP   EndOfForHandler   
0687   F9           FORLOOPISCOMPLETE:   SPHL      
0688   2A 5D 01               LHLD   PROG_PTR_TEMP   
068B   C3 2B 04               JMP   ExecNext   
068E   2B           EVALEXPRESSION:   DCX   H   
068F   16 00                  MVI   D,00h   
0691   D5                     PUSH   D   
0692   0E 01                  MVI   C,01h   
0694   CD B6 01               CALL   CheckEnoughVarSpace   
0697   CD C8 06               CALL   EvalTerm   
069A   22 5F 01               SHLD   TEMP2   
069D   2A 5F 01     ARITHPARSE:   LHLD   TEMP2   
06A0   C1                     POP   B   
06A1   7E                     MOV   A,M   
06A2   16 00                  MVI   D,00h   
06A4   D6 98                  SUI   0x98   ;KWID_PLUS	
06A6   D8                     RC      
06A7   FE 04                  CPI   0x04   
06A9   D0                     RNC      
06AA   5F                     MOV   E,A   
06AB   07                     RLC      
06AC   83                     ADD   E   
06AD   5F                     MOV   E,A   
06AE   21 4B 00               LXI   H,KW_ARITH_OP_FNS   
06B1   19                     DAD   D   
06B2   78                     MOV   A,B   
06B3   56                     MOV   D,M   
06B4   BA                     CMP   D   
06B5   D0                     RNC      
06B6   23                     INX   H   
06B7   C5                     PUSH   B   
06B8   01 9D 06               LXI   B,ArithParse   
06BB   C5                     PUSH   B   
06BC   4A                     MOV   C,D   ;???
06BD   CD 06 0A               CALL   FPush   
06C0   51                     MOV   D,C   
06C1   F7                     RST   6   
06C2   2A 5F 01               LHLD   TEMP2   
06C5   C3 91 06               JMP   EvalExpression+3   
06C8   D7           EVALTERM:   RST   02   ;RST NextChar	
06C9   DA B7 0A               JC   FIn   
06CC   CD 8E 04               CALL   CharIsAlpha   
06CF   D2 F7 06               JNC   EvalVarTerm   
06D2   FE 98                  CPI   0x98   ;KWID_PLUS	
06D4   CA C8 06               JZ   EvalTerm   
06D7   FE 2E                  CPI   "."   
06D9   CA B7 0A               JZ   FIn   
06DC   FE 99                  CPI   0x99   ;KWID_MINUS	
06DE   CA EE 06               JZ   EvalMinusTerm   
06E1   D6 9F                  SUI   9Fh   
06E3   D2 01 07               JNC   EvalInlineFn   
06E6   CF           EVALBRACKETED:   RST   01   ; SyntaxCheck	
06E7   28                     DB   28h   ;"("	
06E8   CD 8E 06               CALL   EvalExpression   
06EB   CF                     RST   01   ; SyntaxCheck	
06EC   29                     DB   29h   ;")"	
06ED   C9                     RET      
06EE   CD C8 06     EVALMINUSTERM:   CALL   EvalTerm   
06F1   E5                     PUSH   H   
06F2   CD FE 09               CALL   FNegate   
06F5                POPRET:      
06F5   E1                     POP   H   
06F6   C9                     RET      
06F7   CD 1F 07     EVALVARTERM:   CALL   GetVar   
06FA   E5                     PUSH   H   
06FB   EB                     XCHG      
06FC   CD 13 0A               CALL   FLoadFromMem   
06FF   E1                     POP   H   
0700   C9                     RET      
0701   06 00        EVALINLINEFN:   MVI   B,00h   
0703   07                     RLC      
0704   4F                     MOV   C,A   
0705   C5                     PUSH   B   
0706   D7                     RST   02   ;RST NextChar	
0707   CD E6 06               CALL   EvalBracketed   
070A   E3                     XTHL      
070B   11 F5 06               LXI   D,PopRet   
070E   D5                     PUSH   D   
070F   01 3D 00               LXI   B,KW_INLINE_FNS   
0712   09                     DAD   B   
0713   F7                     RST   6   
0714   C9                     RET      
0715   2B           DIMCONTD:   DCX   H   
0716   D7                     RST   02   ;RST NextChar	
0717   C8                     RZ      
0718   CF                     RST   01   ; SyntaxCheck	
0719   2C                     DB   2Ch   ;","	
071A   01 15 07     DIM:      LXI   B,DimContd   
071D   C5                     PUSH   B   
071E   F6                     DB   0xF6   
071F   AF           GETVAR:   XRA   A   
0720   32 5B 01               STA   DIM_OR_EVAL   
0723   46                     MOV   B,M   
0724   CD 8E 04               CALL   CharIsAlpha   
0727   DA D0 01               JC   SyntaxError   
072A   AF                     XRA   A   
072B   4F                     MOV   C,A   
072C   D7                     RST   02   ;RST NextChar	
072D   D2 32 07               JNC   L072E   
0730   4F                     MOV   C,A   
0731   D7                     RST   02   ;RST NextChar	
0732   D6 28        L072E:    SUI   "("   
0734   CA 8E 07               JZ   GetArrayVar   
0737   E5                     PUSH   H   
0738   2A 69 01               LHLD   VAR_ARRAY_BASE   
073B   EB                     XCHG      
073C   2A 67 01               LHLD   VAR_BASE   
073F   E7           FINDVARLOOP:   RST   4   
0740   CA 56 07               JZ   AllocNewVar   
0743   79                     MOV   A,C   
0744   96                     SUB   M   
0745   23                     INX   H   
0746   C2 4B 07               JNZ   NotIt   
0749   78                     MOV   A,B   
074A   96                     SUB   M   
074B   23           NOTIT:    INX   H   
074C   CA 86 07               JZ   FinPtr   
074F   23                     INX   H   
0750   23                     INX   H   
0751   23                     INX   H   
0752   23                     INX   H   
0753   C3 3F 07               JMP   FindVarLoop   
0756   E1           ALLOCNEWVAR:   POP   H   ;HL=prog ptr
0757   E3                     XTHL      ;(SP)=prog ptr, HL=ret.addr.
0758   D5                     PUSH   D   ; 
0759   11 FA 06               LXI   D,EvalVarTerm+3   ;an address inside EvalTerm
075C   E7                     RST   4   ; 
075D   D1                     POP   D   ; 
075E   CA 89 07               JZ   AlreadyAllocd   ; 
0761   E3                     XTHL      ;(SP)=ret.addr, HL=prog ptr.
0762   E5                     PUSH   H   ;Prog ptr back on stack
0763   C5                     PUSH   B   ;Preserve var name on stack
0764   01 06 00               LXI   B,0006h   
0767   2A 6B 01               LHLD   VAR_TOP   
076A   E5                     PUSH   H   
076B   09                     DAD   B   
076C   C1                     POP   B   
076D   E5                     PUSH   H   
076E   CD A7 01               CALL   CopyMemoryUp   
0771   E1                     POP   H   
0772   22 6B 01               SHLD   VAR_TOP   
0775   60                     MOV   H,B   
0776   69                     MOV   L,C   
0777   22 69 01               SHLD   VAR_ARRAY_BASE   
077A   2B           INITVARLOOP:   DCX   H   
077B   36 00                  MVI   M,00h   
077D   E7                     RST   4   
077E   C2 7A 07               JNZ   InitVarLoop   
0781   D1                     POP   D   
0782   73                     MOV   M,E   
0783   23                     INX   H   
0784   72                     MOV   M,D   
0785   23                     INX   H   
0786   EB           FINPTR:   XCHG      
0787   E1                     POP   H   
0788   C9                     RET      
0789   32 72 01     ALREADYALLOCD:   STA   FACCUM+3   ;A was set to zero at 075A.
078C   E1                     POP   H   
078D   C9                     RET      
078E   C5           GETARRAYVAR:   PUSH   B   
078F   3A 5B 01               LDA   DIM_OR_EVAL   
0792   F5                     PUSH   PSW   
0793   CD 96 04               CALL   GetSubscript   
0796   CF                     RST   01   ; SyntaxCheck	
0797   29                     DB   29h   ;")"	
0798   F1                     POP   PSW   
0799   32 5B 01               STA   DIM_OR_EVAL   
079C   E3                     XTHL      
079D   EB                     XCHG      
079E   29                     DAD   H   
079F   29                     DAD   H   
07A0   E5                     PUSH   H   
07A1   2A 69 01               LHLD   VAR_ARRAY_BASE   
07A4   01                     DB   0x01   ;LXI B,....	
07A5   C1           FINDARRAY:   POP   B   
07A6   09                     DAD   B   
07A7   EB                     XCHG      
07A8   E5                     PUSH   H   
07A9   2A 6B 01               LHLD   VAR_TOP   
07AC   E7                     RST   4   
07AD   EB                     XCHG      
07AE   D1                     POP   D   
07AF   CA D1 07               JZ   AllocArray   
07B2   F7                     RST   6   
07B3   E3                     XTHL      
07B4   E7                     RST   4   
07B5   E1                     POP   H   
07B6   F7                     RST   6   
07B7   C2 A5 07               JNZ   FindArray   
07BA   3A 5B 01               LDA   DIM_OR_EVAL   
07BD   B7                     ORA   A   
07BE   1E 12                  MVI   E,12h   
07C0   C2 D5 01               JNZ   Error   
07C3   D1           L07BF:    POP   D   
07C4   1B                     DCX   D   
07C5   E3                     XTHL      
07C6   E7                     RST   4   
07C7   1E 10                  MVI   E,10h   
07C9   D2 D5 01               JNC   Error   
07CC   D1                     POP   D   
07CD   19                     DAD   D   
07CE   D1                     POP   D   
07CF   EB                     XCHG      
07D0   C9                     RET      
07D1   73           ALLOCARRAY:   MOV   M,E   
07D2   23                     INX   H   
07D3   72                     MOV   M,D   
07D4   23                     INX   H   
07D5   11 2C 00               LXI   D,002Ch   
07D8   3A 5B 01               LDA   DIM_OR_EVAL   
07DB   B7                     ORA   A   
07DC   CA E5 07               JZ   NotDim   
07DF   D1                     POP   D   
07E0   D5                     PUSH   D   
07E1   13                     INX   D   
07E2   13                     INX   D   
07E3   13                     INX   D   
07E4   13                     INX   D   
07E5   D5           NOTDIM:   PUSH   D   
07E6   73                     MOV   M,E   
07E7   23                     INX   H   
07E8   72                     MOV   M,D   
07E9   23                     INX   H   
07EA   E5                     PUSH   H   
07EB   19                     DAD   D   
07EC   CD C3 01               CALL   CheckEnoughMem   
07EF   22 6B 01               SHLD   VAR_TOP   
07F2   D1                     POP   D   
07F3   2B           INITELEMENTS:   DCX   H   
07F4   36 00                  MVI   M,00h   
07F6   E7                     RST   4   
07F7   C2 F3 07               JNZ   InitElements   
07FA   C3 C3 07               JMP   L07BF   
07FD   50           FWORDTOFLOAT:   MOV   D,B   
07FE   1E 00                  MVI   E,00h   
0800   06 90                  MVI   B,90h   ;exponent=2^16
0802   C3 EE 09               JMP   FCharToFloat+5   ; 
0805   21 0F 0C     FADDONEHALF:   LXI   H,ONE_HALF   ;Load BCDE with (float) 0.5.
0808   CD 24 0A     FADDMEM:   CALL   FLoadBCDEfromMem   
080B   C3 16 08               JMP   FAdd+2   
080E   C1           FSUB:     POP   B   ;Get lhs in BCDE.
080F   D1                     POP   D   ; 
0810   CD FE 09               CALL   FNegate   ;Negate rhs and slimily
0813   21                     DB   0x21   ;LXI H,....	;LXI into FAdd + 2.
0814   C1           FADD:     POP   B   ;Get lhs in BCDE.
0815   D1                     POP   D   ; 
0816   78                     MOV   A,B   ;If lhs==0 then we don't need
0817   B7                     ORA   A   ;to do anything and can just
0818   C8                     RZ      ;exit.
0819   3A 72 01               LDA   FACCUM+3   ;If rhs==0 then exit via a copy
081C   B7                     ORA   A   ;of lhs to FACCUM.
081D   CA 16 0A               JZ   FLoadFromBCDE   ; 
0820   90                     SUB   B   ;A=rhs.exponent-lhs.exponent.
0821   D2 30 08               JNC   L082C   ;If rhs" exponent >= lhs"exponent, jump ahead.
0824   2F                     CMA      ;Two's complement the exponent
0825   3C                     INR   A   ;difference, so it's correct.
0826   EB                     XCHG      ; 
0827   CD 06 0A               CALL   FPush   ;Push old rhs
082A   EB                     XCHG      ; 
082B   CD 16 0A               CALL   FLoadFromBCDE   ;rhs = old lhs
082E   C1                     POP   B   ;lhs = old rhs.
082F   D1                     POP   D   ; 
0830   F5           L082C:    PUSH   PSW   ;Preserve exponent diff
0831   CD 3B 0A               CALL   FUnpackMantissas   
0834   67                     MOV   H,A   ;H=sign relationship
0835   F1                     POP   PSW   ;A=exponent diff.
0836   CD CD 08               CALL   FMantissaRtMult   ;Shift lhs mantissa right by (exponent diff) places.
0839   B4                     ORA   H   ;A=0 after last call, so this tests
083A   21 6F 01               LXI   H,FACCUM   ;the sign relationship.
083D   F2 51 08               JP   FSubMantissas   ;Jump ahead if we need to subtract.
0840   CD AD 08               CALL   FAddMantissas   ; 
0843   D2 82 08               JNC   FRoundUp   ;Jump ahead if that didn't overflow.
0846   23                     INX   H   ;Flip the sign in FTEMP_SIGN.
0847   34                     INR   M   ; 
0848   CA A8 08               JZ   Overflow   ;Error out if exponent overflowed.
084B   CD DA 08               CALL   FMantissaRtOnce   ;Shift mantissa one place right
084E   C3 82 08               JMP   FRoundUp   ;Jump ahead.
0851   AF           FSUBMANTISSAS:   XRA   A   ;B=0-B
0852   90                     SUB   B   ; 
0853   47                     MOV   B,A   ; 
0854   7E                     MOV   A,M   ;E=(FACCUM)-E
0855   9B                     SBB   E   ; 
0856   5F                     MOV   E,A   ; 
0857   23                     INX   H   ; 
0858   7E                     MOV   A,M   ;D=(FACCUM+1)-D
0859   9A                     SBB   D   
085A   57                     MOV   D,A   
085B   23                     INX   H   
085C   7E                     MOV   A,M   ;C=(FACCUM+2)-C
085D   99                     SBB   C   ; 
085E   4F                     MOV   C,A   ; 
085F   DC B9 08     FNORMALISE:   CC   FNegateInt   ; 
0862   26 00                  MVI   H,00h   ; 
0864   79                     MOV   A,C   ;Test most-significant bit of mantissa
0865   B7                     ORA   A   ;and jump ahead if it's 1.
0866   FA 82 08               JM   FRoundUp   ; 
0869   FE E0        NORMLOOP:   CPI   0xE0   ;If we've shifted 32 times,
086B   CA C2 09               JZ   FZero   ;then the number is 0.
086E   25                     DCR   H   ; 
086F   78                     MOV   A,B   ;Left-shift extra mantissa byte
0870   87                     ADD   A   ; 
0871   47                     MOV   B,A   ; 
0872   CD 94 08               CALL   FMantissaLeft   ;Left-shift mantissa.
0875   7C                     MOV   A,H   ; 
0876                             ; in code found in https://archive.org/details/bitsavers_mitsMITSAl_6669937/page/n182/mode/1up
0876                             ; the below instruction is JZ, not JP as in https://github.com/option8/Altair-BASIC
0876                             ; this makes sense because otherwise code below this jump is never reached
0876                             ; hoever, cleaner source of this code from https://github.com/bhall66/IMSAI-8080/tree/main/Altair-Basic
0876                             ; does have jp here
0876   F2 69 08               JP   NormLoop   ;Loop
0879   21 72 01     FNORMX:   LXI   H,FACCUM+3   ; 
087C   86                     ADD   M   ; 
087D   77                     MOV   M,A   ;Since A was a -ve number, that certainly should
087E   D2 C2 09               JNC   FZero   ;have carried, hence the extra check for zero.
0881   C8                     RZ      ;?why?
0882   78           FROUNDUP:   MOV   A,B   ;A=extra mantissa byte
0883   21 72 01               LXI   H,FACCUM+3   ; 
0886   B7                     ORA   A   ;If bit 7 of the extra mantissa byte
0887   FC 9E 08               CM   FMantissaInc   ;is set, then round up the mantissa.
088A   46                     MOV   B,M   ;B=exponent
088B   23                     INX   H   ; 
088C   7E                     MOV   A,M   ;A=FTEMP_SIGN
088D   E6 80                  ANI   0x80   ; 
088F   A9                     XRA   C   ;Bit 7 of C is always 1. Thi
0890   4F                     MOV   C,A   ; 
0891   C3 16 0A               JMP   FLoadFromBCDE   ;Exit via copying BCDE to FACCUM.
0894   7B           FMANTISSALEFT:   MOV   A,E   
0895   17                     RAL      
0896   5F                     MOV   E,A   
0897   7A                     MOV   A,D   
0898   17                     RAL      
0899   57                     MOV   D,A   
089A   79                     MOV   A,C   
089B   8F                     ADC   A   
089C   4F                     MOV   C,A   
089D   C9                     RET      
089E   1C           FMANTISSAINC:   INR   E   
089F   C0                     RNZ      
08A0   14                     INR   D   
08A1   C0                     RNZ      
08A2   0C                     INR   C   
08A3   C0                     RNZ      
08A4   0E 80                  MVI   C,80h   ;Mantissa overflowed to zero, so set it
08A6   34                     INR   M   ;to 1 and increment the exponent.
08A7   C0                     RNZ      ;And if the exponent overflows...
08A8   1E 0A        OVERFLOW:   MVI   E,0Ah   
08AA   C3 D5 01               JMP   Error   
08AD   7E           FADDMANTISSAS:   MOV   A,M   
08AE   83                     ADD   E   
08AF   5F                     MOV   E,A   
08B0   23                     INX   H   
08B1   7E                     MOV   A,M   
08B2   8A                     ADC   D   
08B3   57                     MOV   D,A   
08B4   23                     INX   H   
08B5   7E                     MOV   A,M   
08B6   89                     ADC   C   
08B7   4F                     MOV   C,A   
08B8   C9                     RET      
08B9   21 73 01     FNEGATEINT:   LXI   H,FTEMP   
08BC   7E                     MOV   A,M   
08BD   2F                     CMA      
08BE   77                     MOV   M,A   
08BF   AF                     XRA   A   
08C0   6F                     MOV   L,A   
08C1   90                     SUB   B   
08C2   47                     MOV   B,A   
08C3   7D                     MOV   A,L   
08C4   9B                     SBB   E   
08C5   5F                     MOV   E,A   
08C6   7D                     MOV   A,L   
08C7   9A                     SBB   D   
08C8   57                     MOV   D,A   
08C9   7D                     MOV   A,L   
08CA   99                     SBB   C   
08CB   4F                     MOV   C,A   
08CC   C9                     RET      
08CD   06 00        FMANTISSARTMULT:   MVI   B,00h   ;Initialise extra mantissa byte
08CF   3C                     INR   A   
08D0   6F                     MOV   L,A   
08D1   AF           RTMULTLOOP:   XRA   A   
08D2   2D                     DCR   L   
08D3   C8                     RZ      
08D4   CD DA 08               CALL   FMantissaRtOnce   
08D7   C3 D1 08               JMP   RtMultLoop   
08DA   79           FMANTISSARTONCE:   MOV   A,C   
08DB   1F                     RAR      
08DC   4F                     MOV   C,A   
08DD   7A                     MOV   A,D   
08DE   1F                     RAR      
08DF   57                     MOV   D,A   
08E0   7B                     MOV   A,E   
08E1   1F                     RAR      
08E2   5F                     MOV   E,A   
08E3   78                     MOV   A,B   ;NB: B is the extra
08E4   1F                     RAR      ;mantissa byte.
08E5   47                     MOV   B,A   ; 
08E6   C9                     RET      ; 
08E7   C1           FMUL:     POP   B   ;Get lhs in BCDE
08E8   D1                     POP   D   ; 
08E9   EF                     RST   05   ; FTestSign	;If rhs==0 then exit
08EA   C8                     RZ      ; 
08EB   2E 00                  MVI   L,00h   ;L=0 to signify exponent add
08ED   CD 9F 09               CALL   FExponentAdd   
08F0   79                     MOV   A,C   
08F1   32 1B 09               STA   FMulInnerLoop+13   
08F4   EB                     XCHG      
08F5   22 16 09               SHLD   FMulInnerLoop+8   
08F8   01 00 00               LXI   B,0000h   
08FB   50                     MOV   D,B   
08FC   58                     MOV   E,B   
08FD   21 62 08               LXI   H,FNormalise+3   
0900   E5                     PUSH   H   
0901   21 09 09               LXI   H,FMulOuterLoop   
0904   E5                     PUSH   H   
0905   E5                     PUSH   H   
0906   21 6F 01               LXI   H,FACCUM   
0909   7E           FMULOUTERLOOP:   MOV   A,M   ;A=FACCUM mantissa byte
090A   23                     INX   H   ; 
090B   E5                     PUSH   H   ;Preserve FACCUM ptr
090C   2E 08                  MVI   L,08h   ;8 bits to do
090E   1F           FMULINNERLOOP:   RAR      ;Test lowest bit of mantissa byte
090F   67                     MOV   H,A   ;Preserve mantissa byte
0910   79                     MOV   A,C   ;A=result mantissa's high byte
0911   D2 1D 09               JNC   L0919   ;If that bit of multiplicand was 0, then skip over adding mantissas.
0914   E5                     PUSH   H   ; 
0915   21 00 00               LXI   H,0000h   ; 
0918   19                     DAD   D   ; 
0919   D1                     POP   D   ; 
091A   CE 00                  ACI   00   ;A=result mantissa high byte. This gets back to C
091C   EB                     XCHG      ;in the call to FMantissaRtOnce+1.
091D   CD DB 08     L0919:    CALL   FMantissaRtOnce+1   
0920   2D                     DCR   L   
0921   7C                     MOV   A,H   ;Restore mantissa byte and
0922   C2 0E 09               JNZ   FMulInnerLoop   ;jump back if L is not yet 0.
0925   E1           POPHLANDRETURN:   POP   H   ;Restore FACCUM ptr
0926   C9                     RET      ;Return to FMulOuterLoop, or if finished that then exit to FNormalise
0927   CD 06 0A     FDIVBYTEN:   CALL   FPush   ; 
092A   01 20 84               LXI   B,8420h   ;BCDE=(float)10;
092D   11 00 00               LXI   D,0000h   
0930   CD 16 0A               CALL   FLoadFromBCDE   
0933   C1           FDIV:     POP   B   
0934   D1                     POP   D   
0935   EF                     RST   05   ; FTestSign	
0936   CA D3 01               JZ   DivideByZero   
0939   2E FF                  MVI   L,0xFF   
093B   CD 9F 09               CALL   FExponentAdd   
093E   34                     INR   M   
093F   34                     INR   M   
0940   2B                     DCX   H   
0941   7E                     MOV   A,M   
0942   32 64 09               STA   FDivA+1   
0945   2B                     DCX   H   
0946   7E                     MOV   A,M   
0947   32 60 09               STA   FDivB+1   
094A   2B                     DCX   H   
094B   7E                     MOV   A,M   
094C   32 5C 09               STA   FDivC+1   
094F   41                     MOV   B,C   
0950   EB                     XCHG      
0951   AF                     XRA   A   
0952   4F                     MOV   C,A   
0953   57                     MOV   D,A   
0954   5F                     MOV   E,A   
0955   32 67 09               STA   FDivG+1   
0958   E5           FDIVLOOP:   PUSH   H   
0959   C5                     PUSH   B   
095A   7D                     MOV   A,L   
095B   D6 00        FDIVC:    SUI   00h   
095D   6F                     MOV   L,A   
095E   7C                     MOV   A,H   
095F   DE 00        FDIVB:    SBI   00   
0961   67                     MOV   H,A   
0962   78                     MOV   A,B   
0963   DE 00        FDIVA:    SBI   00   
0965   47                     MOV   B,A   
0966   3E 00        FDIVG:    MVI   A,00h   
0968   DE 00                  SBI   00   
096A   3F                     CMC      
096B   D2 75 09               JNC   FDiv2   
096E   32 67 09               STA   FDivG+1   
0971   F1                     POP   PSW   
0972   F1                     POP   PSW   
0973   37                     STC      
0974   D2                     DB   0xD2   ;JNC ....	
0975   C1           FDIV2:    POP   B   
0976   E1                     POP   H   
0977   79                     MOV   A,C   
0978   3C                     INR   A   
0979   3D                     DCR   A   
097A   1F                     RAR      
097B   FA 83 08               JM   FRoundUp+1   
097E   17                     RAL      
097F   CD 94 08               CALL   FMantissaLeft   
0982   29                     DAD   H   
0983   78                     MOV   A,B   
0984   17                     RAL      
0985   47                     MOV   B,A   
0986   3A 67 09               LDA   FDivG+1   
0989   17                     RAL      
098A   32 67 09               STA   FDivG+1   
098D   79                     MOV   A,C   
098E   B2                     ORA   D   
098F   B3                     ORA   E   
0990   C2 58 09               JNZ   FDivLoop   
0993   E5                     PUSH   H   
0994   21 72 01               LXI   H,FACCUM+3   
0997   35                     DCR   M   
0998   E1                     POP   H   
0999   C2 58 09               JNZ   FDivLoop   
099C   C3 A8 08               JMP   Overflow   
099F   78           FEXPONENTADD:   MOV   A,B   
09A0   B7                     ORA   A   
09A1   CA BE 09               JZ   MulDv2   
09A4   7D                     MOV   A,L   ;A=0 for add, FF for subtract.
09A5   21 72 01               LXI   H,FACCUM+3   ; 
09A8   AE                     XRA   M   ;XOR with FAccum's exponent.
09A9   80                     ADD   B   ;Add exponents
09AA   47                     MOV   B,A   ; 
09AB   1F                     RAR      ;Carry (after the add) into bit 7.
09AC   A8                     XRA   B   ;XOR with old bit 7.
09AD   78                     MOV   A,B   ; 
09AE   F2 BD 09               JP   MulDv1   ;If
09B1   C6 80                  ADI   0x80   
09B3   77                     MOV   M,A   
09B4   CA 25 09               JZ   PopHLandReturn   
09B7   CD 3B 0A               CALL   FUnpackMantissas   
09BA   77                     MOV   M,A   
09BB   2B                     DCX   H   
09BC   C9                     RET      
09BD   B7           MULDV1:   ORA   A   
09BE   E1           MULDV2:   POP   H   ;Ignore return address so we'll end
09BF   FA A8 08               JM   Overflow   
09C2   AF           FZERO:    XRA   A   
09C3   32 72 01               STA   FACCUM+3   
09C6   C9                     RET      
09C7   CD 21 0A     FMULBYTEN:   CALL   FCopyToBCDE   
09CA   78                     MOV   A,B   
09CB   B7                     ORA   A   
09CC   C8                     RZ      
09CD   C6 02                  ADI   02   
09CF   DA A8 08               JC   Overflow   
09D2   47                     MOV   B,A   
09D3   CD 16 08               CALL   FAdd+2   
09D6   21 72 01               LXI   H,FACCUM+3   
09D9   34                     INR   M   
09DA   C0                     RNZ      
09DB   C3 A8 08               JMP   Overflow   
09DE   3A 71 01     FTESTSIGN_TAIL:   LDA   FACCUM+2   
09E1   FE                     DB   0xFE   
09E2   2F           INVSIGNTOINT:   CMA      
09E3   17           SIGNTOINT:   RAL      
09E4   9F                     SBB   A   
09E5   C0                     RNZ      
09E6   3C                     INR   A   
09E7   C9                     RET      
09E8   EF           SGN:      RST   05   ; FTestSign	
09E9   06 88        FCHARTOFLOAT:   MVI   B,88h   ;ie 2^8
09EB   11 00 00               LXI   D,0000h   
09EE   21 72 01               LXI   H,FACCUM+3   
09F1   4F                     MOV   C,A   
09F2   70                     MOV   M,B   
09F3   06 00                  MVI   B,00h   
09F5   23                     INX   H   
09F6   36 80                  MVI   M,80h   
09F8   17                     RAL      
09F9   C3 5F 08               JMP   FNormalise   
09FC   EF           ABS:      RST   05   ; FTestSign	
09FD   F0                     RP      
09FE   21 71 01     FNEGATE:   LXI   H,FACCUM+2   
0A01   7E                     MOV   A,M   
0A02   EE 80                  XRI   0x80   
0A04   77                     MOV   M,A   
0A05   C9                     RET      
0A06   EB           FPUSH:    XCHG      
0A07   2A 6F 01               LHLD   FACCUM   
0A0A   E3                     XTHL      
0A0B   E5                     PUSH   H   
0A0C   2A 71 01               LHLD   FACCUM+2   
0A0F   E3                     XTHL      
0A10   E5                     PUSH   H   
0A11   EB                     XCHG      
0A12   C9                     RET      
0A13   CD 24 0A     FLOADFROMMEM:   CALL   FLoadBCDEfromMem   
0A16   EB           FLOADFROMBCDE:   XCHG      
0A17   22 6F 01               SHLD   FACCUM   
0A1A   60                     MOV   H,B   
0A1B   69                     MOV   L,C   
0A1C   22 71 01               SHLD   FACCUM+2   
0A1F   EB                     XCHG      
0A20   C9                     RET      
0A21   21 6F 01     FCOPYTOBCDE:   LXI   H,FACCUM   
0A24   5E           FLOADBCDEFROMMEM:   MOV   E,M   
0A25   23                     INX   H   
0A26   56                     MOV   D,M   
0A27   23                     INX   H   
0A28   4E                     MOV   C,M   
0A29   23                     INX   H   
0A2A   46                     MOV   B,M   
0A2B   23           INCHLRETURN:   INX   H   
0A2C   C9                     RET      
0A2D   11 6F 01     FCOPYTOMEM:   LXI   D,FACCUM   
0A30   06 04                  MVI   B,04h   
0A32   1A           FCOPYLOOP:   LDAX   D   
0A33   77                     MOV   M,A   
0A34   13                     INX   D   
0A35   23                     INX   H   
0A36   05                     DCR   B   
0A37   C2 32 0A               JNZ   FCopyLoop   
0A3A   C9                     RET      
0A3B   21 71 01     FUNPACKMANTISSAS:   LXI   H,FACCUM+2   
0A3E   7E                     MOV   A,M   ; 
0A3F   07                     RLC      ;Move FACCUM's sign to bit 0.
0A40   37                     STC      ;Set MSB of FACCUM mantissa,
0A41   1F                     RAR      ;FACCUM's sign is now in carry.
0A42   77                     MOV   M,A   ; 
0A43   3F                     CMC      ;Negate FACCUM's sign.
0A44   1F                     RAR      ;Bit 7 of A is now FACCUM's sign.
0A45   23                     INX   H   ;Store negated FACCUM sign at FTEMP_SIGN.
0A46   23                     INX   H   ; 
0A47   77                     MOV   M,A   ; 
0A48   79                     MOV   A,C   ; 
0A49   07                     RLC      ;Set MSB of BCDE mantissa,
0A4A   37                     STC      ;BCDE's sign is now in carry.
0A4B   1F                     RAR      ; 
0A4C   4F                     MOV   C,A   ; 
0A4D   1F                     RAR      ;Bit 7 of A is now BCDE's sign
0A4E   AE                     XRA   M   ;XORed with FTEMP_SIGN.
0A4F   C9                     RET      ; 
0A50   78           FCOMPARE:   MOV   A,B   
0A51   B7                     ORA   A   
0A52   CA 28 00               JZ   FTestSign   
0A55   21 E2 09               LXI   H,InvSignToInt   
0A58   E5                     PUSH   H   
0A59   EF                     RST   05   ; FTestSign	
0A5A   79                     MOV   A,C   
0A5B   C8                     RZ      
0A5C   21 71 01               LXI   H,FACCUM+2   
0A5F   AE                     XRA   M   
0A60   79                     MOV   A,C   
0A61   F8                     RM      
0A62   CD 68 0A               CALL   FIsEqual   
0A65   1F                     RAR      
0A66   A9                     XRA   C   
0A67   C9                     RET      
0A68   23           FISEQUAL:   INX   H   
0A69   78                     MOV   A,B   
0A6A   BE                     CMP   M   
0A6B   C0                     RNZ      
0A6C   2B                     DCX   H   
0A6D   79                     MOV   A,C   
0A6E   BE                     CMP   M   
0A6F   C0                     RNZ      
0A70   2B                     DCX   H   
0A71   7A                     MOV   A,D   
0A72   BE                     CMP   M   
0A73   C0                     RNZ      
0A74   2B                     DCX   H   
0A75   7B                     MOV   A,E   
0A76   96                     SUB   M   
0A77   C0                     RNZ      ; 
0A78   E1                     POP   H   ;Lose 0A5E
0A79   E1                     POP   H   ;Lose 09DE
0A7A   C9                     RET      ;Return to caller
0A7B   47           FASINTEGER:   MOV   B,A   ; 
0A7C   4F                     MOV   C,A   
0A7D   57                     MOV   D,A   
0A7E   5F                     MOV   E,A   
0A7F   B7                     ORA   A   
0A80   C8                     RZ      
0A81   E5                     PUSH   H   
0A82   CD 21 0A               CALL   FCopyToBCDE   
0A85   CD 3B 0A               CALL   FUnpackMantissas   
0A88   AE                     XRA   M   ;Get sign back
0A89   67                     MOV   H,A   
0A8A   FC 9F 0A               CM   FMantissaDec   
0A8D   3E 98                  MVI   A,98h   
0A8F   90                     SUB   B   ;by (24-exponent) places?
0A90   CD CD 08               CALL   FMantissaRtMult   ;WHY?
0A93   7C                     MOV   A,H   
0A94   17                     RAL      
0A95   DC 9E 08               CC   FMantissaInc   
0A98   06 00                  MVI   B,00h   ;Needed for FNegateInt.
0A9A   DC B9 08               CC   FNegateInt   
0A9D   E1                     POP   H   
0A9E   C9                     RET      
0A9F   1B           FMANTISSADEC:   DCX   D   ;DE--
0AA0   7A                     MOV   A,D   ;If DE!=0xFFFF...
0AA1   A3                     ANA   E   ; 
0AA2   3C                     INR   A   ; 
0AA3   C0                     RNZ      ;... then return
0AA4   0D                     DCR   C   ;C--
0AA5   C9                     RET      ; 
0AA6   21 72 01     INT:      LXI   H,FACCUM+3   ; 
0AA9   7E                     MOV   A,M   ; 
0AAA   FE 98                  CPI   0x98   ; 
0AAC   D0                     RNC      ; 
0AAD   CD 7B 0A               CALL   FAsInteger   ; 
0AB0   36 98                  MVI   M,98h   ; 
0AB2   79                     MOV   A,C   ; 
0AB3   17                     RAL      ; 
0AB4   C3 5F 08               JMP   FNormalise   ; 
0AB7   2B           FIN:      DCX   H   ; 
0AB8   CD C2 09               CALL   FZero   ; 
0ABB   47                     MOV   B,A   ;B=count of fractional digits
0ABC   57                     MOV   D,A   ;D=exponent sign
0ABD   5F                     MOV   E,A   ;E=exponent
0ABE   2F                     CMA      ;C=decimal_point_done (0xFF for no, 0x00 for yes)
0ABF   4F                     MOV   C,A   ; 
0AC0   D7           FINLOOP:   RST   02   ;RST NextChar	
0AC1   DA 08 0B               JC   ProcessDigit   
0AC4   FE 2E                  CPI   "."   
0AC6   CA E8 0A               JZ   L0AE4   
0AC9   FE 45                  CPI   "E"   
0ACB   C2 EC 0A               JNZ   ScaleResult   
0ACE   D7           GETEXPONENT:   RST   02   ;RST NextChar	
0ACF   15                     DCR   D   
0AD0   FE 99                  CPI   0x99   ;KWID_MINUS	
0AD2   CA DC 0A               JZ   NextExponentDigit   
0AD5   14                     INR   D   
0AD6   FE 98                  CPI   0x98   ;KWID_PLUS	
0AD8   CA DC 0A               JZ   NextExponentDigit   
0ADB   2B                     DCX   H   
0ADC   D7           NEXTEXPONENTDIGIT:   RST   02   ;RST NextChar	
0ADD   DA 27 0B               JC   DoExponentDigit   
0AE0   14                     INR   D   
0AE1   C2 EC 0A               JNZ   ScaleResult   
0AE4   AF                     XRA   A   
0AE5   93                     SUB   E   
0AE6   5F                     MOV   E,A   
0AE7   0C                     INR   C   ;C was 0xFF, so here it
0AE8   0C           L0AE4:    INR   C   ;becomes 0x01.
0AE9   CA C0 0A               JZ   FInLoop   ;If C is now zero
0AEC   E5           SCALERESULT:   PUSH   H   
0AED   7B                     MOV   A,E   
0AEE   90                     SUB   B   
0AEF   F4 00 0B     DECIMALLOOP:   CP   DecimalShiftUp   
0AF2   F2 FB 0A               JP   DecimalLoopEnd   
0AF5   F5                     PUSH   PSW   
0AF6   CD 27 09               CALL   FDivByTen   
0AF9   F1                     POP   PSW   
0AFA   3C                     INR   A   
0AFB   C2 EF 0A     DECIMALLOOPEND:   JNZ   DecimalLoop   
0AFE   E1                     POP   H   
0AFF   C9                     RET      
0B00   C8           DECIMALSHIFTUP:   RZ      
0B01   F5                     PUSH   PSW   
0B02   CD C7 09               CALL   FMulByTen   
0B05   F1                     POP   PSW   
0B06   3D                     DCR   A   
0B07   C9                     RET      
0B08   D5           PROCESSDIGIT:   PUSH   D   
0B09   57                     MOV   D,A   
0B0A   78                     MOV   A,B   
0B0B   89                     ADC   C   
0B0C   47                     MOV   B,A   
0B0D   C5                     PUSH   B   
0B0E   E5                     PUSH   H   
0B0F   D5                     PUSH   D   
0B10   CD C7 09               CALL   FMulByTen   
0B13   F1                     POP   PSW   
0B14   D6 30                  SUI   "0"   
0B16   CD 06 0A               CALL   FPush   
0B19   CD E9 09               CALL   FCharToFloat   
0B1C   C1                     POP   B   
0B1D   D1                     POP   D   
0B1E   CD 16 08               CALL   FAdd+2   
0B21   E1                     POP   H   
0B22   C1                     POP   B   
0B23   D1                     POP   D   
0B24   C3 C0 0A               JMP   FInLoop   
0B27   7B           DOEXPONENTDIGIT:   MOV   A,E   
0B28   07                     RLC      
0B29   07                     RLC      
0B2A   83                     ADD   E   
0B2B   07                     RLC      
0B2C   86                     ADD   M   
0B2D   D6 30                  SUI   "0"   
0B2F   5F                     MOV   E,A   
0B30   C3 DC 0A               JMP   NextExponentDigit   
0B33   E5           PRINTIN:   PUSH   H   
0B34   21 88 01               LXI   H,szIn   
0B37   CD A7 05               CALL   PrintString   
0B3A   E1                     POP   H   
0B3B   EB           PRINTINT:   XCHG      ;DE=integer
0B3C   AF                     XRA   A   ;A=0 (ends up in C)
0B3D   06 98                  MVI   B,98h   ;B (ie exponent) = 24
0B3F   CD EE 09               CALL   FCharToFloat+5   
0B42   21 A6 05               LXI   H,PrintString-1   
0B45   E5                     PUSH   H   
0B46   21 74 01     FOUT:     LXI   H,FBUFFER   
0B49   E5                     PUSH   H   
0B4A   EF                     RST   05   ; FTestSign	
0B4B   36 20                  MVI   M," "   
0B4D   F2 52 0B               JP   DoZero   
0B50   36 2D                  MVI   M,"-"   
0B52   23           DOZERO:   INX   H   
0B53   36 30                  MVI   M,"0"   
0B55   CA FB 0B               JZ   NullTerm-3   
0B58   E5                     PUSH   H   
0B59   FC FE 09               CM   FNegate   
0B5C   AF                     XRA   A   
0B5D   F5                     PUSH   PSW   
0B5E   CD 01 0C               CALL   ToUnder1000000   
0B61   01 43 91     TOOVER100000:   LXI   B,9143h   ;BCDE=(float)100,000.
0B64   11 F8 4F               LXI   D,4FF8h   ; 
0B67   CD 50 0A               CALL   FCompare   ;If FACCUM >= 100,000
0B6A   C2 7E 0B               JNZ   PrepareToPrint   ; !!! Number is in range
0B6D                             ;JPO PrepareToPrint         ; ORIGINAL CODE modified to work in Z80 mode
0B6D   F1                     POP   PSW   ;A=DecExpAdj
0B6E   CD 01 0B               CALL   DecimalShiftUp+1   ;FACCUM*=10; DecExpAdj--;
0B71   F5                     PUSH   PSW   ; 
0B72   C3 61 0B               JMP   ToOver100000   
0B75   CD 27 09     L0B71:    CALL   FDivByTen   
0B78   F1                     POP   PSW   
0B79   3C                     INR   A   ;DecExpAdj++;
0B7A   F5                     PUSH   PSW   
0B7B   CD 01 0C               CALL   ToUnder1000000   
0B7E   CD 05 08     PREPARETOPRINT:   CALL   FAddOneHalf   
0B81   3C                     INR   A   
0B82   CD 7B 0A               CALL   FAsInteger   
0B85   CD 16 0A               CALL   FLoadFromBCDE   
0B88   01 06 02               LXI   B,0206h   
0B8B   F1                     POP   PSW   ;A=DecExpAdj+6.
0B8C   81                     ADD   C   ; 
0B8D   FA 99 0B               JM   L0B95   ;If A<1 or A>6 Then goto fixme.
0B90   FE 07                  CPI   0x07   ; 
0B92   D2 99 0B               JNC   L0B95   ; 
0B95   3C                     INR   A   ; 
0B96   47                     MOV   B,A   ; 
0B97   3E 01                  MVI   A,01h   ;A=1, indicating scientific notation.
0B99   3D           L0B95:    DCR   A   ; 
0B9A   E1                     POP   H   ;HL=output buffer
0B9B   F5                     PUSH   PSW   ;Preserve decimal exponent adjustment (and preserve zero flag used to indicate scientific notation wanted).
0B9C   11 13 0C               LXI   D,DECIMAL_POWERS   
0B9F   05           NEXTDIGIT:   DCR   B   
0BA0   36 2E                  MVI   M,"."   
0BA2   CC 2B 0A               CZ   IncHLReturn   ;0A27 just happens to inc HL and RET.
0BA5   C5                     PUSH   B   ; 
0BA6   E5                     PUSH   H   ; 
0BA7   D5                     PUSH   D   ;DE=>decimal power
0BA8   CD 21 0A               CALL   FCopyToBCDE   ;Store BCDE to FACCUM.
0BAB   E1                     POP   H   ;HL=>decimal power.
0BAC   06 2F                  MVI   B,"0"-1   ; 
0BAE   04           DIGITLOOP:   INR   B   ; 
0BAF   7B                     MOV   A,E   ; 
0BB0   96                     SUB   M   ; 
0BB1   5F                     MOV   E,A   ; 
0BB2   23                     INX   H   ; 
0BB3   7A                     MOV   A,D   ; 
0BB4   9E                     SBB   M   ; 
0BB5   57                     MOV   D,A   ; 
0BB6   23                     INX   H   ; 
0BB7   79                     MOV   A,C   ; 
0BB8   9E                     SBB   M   ; 
0BB9   4F                     MOV   C,A   ; 
0BBA   2B                     DCX   H   ; 
0BBB   2B                     DCX   H   ; 
0BBC   D2 AE 0B               JNC   DigitLoop   ; 
0BBF   CD AD 08               CALL   FAddMantissas   ; 
0BC2   23                     INX   H   ;???
0BC3   CD 16 0A               CALL   FLoadFromBCDE   ; 
0BC6   EB                     XCHG      ; 
0BC7   E1                     POP   H   ;HL=output buffer
0BC8   70                     MOV   M,B   ; 
0BC9   23                     INX   H   ; 
0BCA   C1                     POP   B   ;B=decimal point place
0BCB   0D                     DCR   C   ;C=digits remaining, minus one.
0BCC   C2 9F 0B               JNZ   NextDigit   ; 
0BCF   05                     DCR   B   ; 
0BD0   CA DF 0B               JZ   L0BDB   ; 
0BD3   2B           L0BCF:    DCX   H   ; 
0BD4   7E                     MOV   A,M   ; 
0BD5   FE 30                  CPI   "0"   ; 
0BD7   CA D3 0B               JZ   L0BCF   ; 
0BDA   FE 2E                  CPI   "."   ; 
0BDC   C4 2B 0A               CNZ   IncHLReturn   ; 
0BDF   F1           L0BDB:    POP   PSW   ; 
0BE0   CA FE 0B               JZ   NullTerm   ; 
0BE3   36 45                  MVI   M,"E"   ;Write "E"
0BE5   23                     INX   H   ; 
0BE6   36 2B                  MVI   M,"+"   ;Write "+" or "-"
0BE8   F2 EF 0B               JP   L0BEB   ; 
0BEB   36 2D                  MVI   M,"-"   ;Write "-" if it's negative, also
0BED   2F                     CMA      ;two's complement the decimal exponent
0BEE   3C                     INR   A   ;so printing it will work.
0BEF   06 2F        L0BEB:    MVI   B,"0"-1   ; 
0BF1   04           EXPDIGITLOOP:   INR   B   ; 
0BF2   D6 0A                  SUI   0Ah   ; 
0BF4   D2 F1 0B               JNC   ExpDigitLoop   ; 
0BF7   C6 3A                  ADI   3Ah   ;Adding "0"+10 gives us the 2nd digit
0BF9   23                     INX   H   ;of the exponent.
0BFA   70                     MOV   M,B   ;Write first digit.
0BFB   23                     INX   H   ; 
0BFC   77                     MOV   M,A   ;Write second digit of exponent.
0BFD   23                     INX   H   ; 
0BFE   71           NULLTERM:   MOV   M,C   ;Null byte terminator.
0BFF   E1                     POP   H   ; 
0C00   C9                     RET      ; 
0C01   01 74 94     TOUNDER1000000:   LXI   B,9474h   ; 
0C04   11 F7 23               LXI   D,23F7h   ; 
0C07   CD 50 0A               CALL   FCompare   ; 
0C0A   E1                     POP   H   ; 
0C0B   CA 75 0B               JZ   L0B71   ; !!! remove parity check operation
0C0E                             ; JPE L0B71                 ; ORIGINAL CODE number too big, divide by 10
0C0E                             ;	JPO L0B71	;
0C0E   E9                     PCHL      ; 
0C0F   00 00 00 80  ONE_HALF:   DB   0x00,0x00,0x00,0x80   ; DD 0.5	
0C13   A0 86 01     DECIMAL_POWERS:   DB   0xA0,0x86,0x01   ; DT 100000	
0C16   10 27 00               DB   0x10,0x27,0x00   ; DT 10000	
0C19   E8 03 00               DB   0xE8,0x03,0x00   ; DT 1000	
0C1C   64 00 00               DB   0x64,0x00,0x00   ; DT 100	
0C1F   0A 00 00               DB   0x0A,0x00,0x00   ; DT 10	
0C22   01 00 00               DB   0x01,0x00,0x00   ; DT 1	
0C25   EF           SQR:      RST   05   ; FTestSign	;
0C26   FA A6 04               JM   FunctionCallError   ; 
0C29   C8                     RZ      ; 
0C2A   21 72 01               LXI   H,FACCUM+3   ; 
0C2D   7E                     MOV   A,M   ; 
0C2E   1F                     RAR      ; 
0C2F   F5                     PUSH   PSW   ; 
0C30   E5                     PUSH   H   ; 
0C31   3E 40                  MVI   A,40h   ; 
0C33   17                     RAL      ; 
0C34   77                     MOV   M,A   ; 
0C35   21 74 01               LXI   H,FBUFFER   ; 
0C38   CD 2D 0A               CALL   FCopyToMem   ; 
0C3B   3E 04                  MVI   A,04h   ; 
0C3D   F5           SQRLOOP:   PUSH   PSW   ; 
0C3E   CD 06 0A               CALL   FPush   ; 
0C41   21 74 01               LXI   H,FBUFFER   ; 
0C44   CD 24 0A               CALL   FLoadBCDEfromMem   
0C47   CD 35 09               CALL   FDiv+2   
0C4A   C1                     POP   B   
0C4B   D1                     POP   D   
0C4C   CD 16 08               CALL   FAdd+2   
0C4F   01 00 80               LXI   B,8000h   
0C52   51                     MOV   D,C   
0C53   59                     MOV   E,C   
0C54   CD E9 08               CALL   FMul+2   
0C57   F1                     POP   PSW   
0C58   3D                     DCR   A   
0C59   C2 3D 0C               JNZ   SqrLoop   
0C5C   E1                     POP   H   
0C5D   F1                     POP   PSW   
0C5E   C6 C0                  ADI   0xC0   
0C60   86                     ADD   M   
0C61   77                     MOV   M,A   
0C62   C9                     RET      
0C63   EF           RND:      RST   05   ; FTestSign	
0C64   FA 80 0C               JM   L0C7C   
0C67   21 95 0C               LXI   H,RND_SEED   
0C6A   CD 13 0A               CALL   FLoadFromMem   
0C6D   C8                     RZ      
0C6E   01 35 98               LXI   B,9835h   
0C71   11 7A 44               LXI   D,447Ah   
0C74   CD E9 08               CALL   FMul+2   
0C77   01 28 68               LXI   B,0x6828   
0C7A   11 46 B1               LXI   D,0xB146   
0C7D   CD 16 08               CALL   FAdd+2   
0C80   CD 21 0A     L0C7C:    CALL   FCopyToBCDE   
0C83   7B                     MOV   A,E   
0C84   59                     MOV   E,C   
0C85   4F                     MOV   C,A   
0C86   36 80                  MVI   M,80h   
0C88   2B                     DCX   H   
0C89   46                     MOV   B,M   
0C8A   36 80                  MVI   M,80h   
0C8C   CD 62 08               CALL   FNormalise+3   
0C8F   21 95 0C               LXI   H,RND_SEED   
0C92   C3 2D 0A               JMP   FCopyToMem   
0C95   52 C7 4F 80  RND_SEED:   DB   52h,0C7h,4Fh,80h   
0C99   CD 06 0A     SIN:      CALL   FPush   ;ush x
0C9C   01 49 83               LXI   B,8349h   ;CDE=2p
0C9F   11 DB 0F               LXI   D,0FDBh   ; 
0CA2   CD 16 0A               CALL   FLoadFromBCDE   ;hs = 2p
0CA5   C1                     POP   B   ;hs = x
0CA6   D1                     POP   D   ; 
0CA7   CD 35 09               CALL   FDiv+2   ;=x/2p
0CAA   CD 06 0A               CALL   FPush   ; 
0CAD   CD A6 0A               CALL   Int   ;hs = INT(u)
0CB0   C1                     POP   B   ;hs = u
0CB1   D1                     POP   D   ; 
0CB2   CD 10 08               CALL   FSub+2   ;=u-INT(u)
0CB5   01 00 7F               LXI   B,7F00h   ;CDE=0.25
0CB8   51                     MOV   D,C   ; 
0CB9   59                     MOV   E,C   ; 
0CBA   CD 10 08               CALL   FSub+2   ; 
0CBD   EF                     RST   05   ; FTestSign	;
0CBE   37                     STC      ;set carry (ie no later negate)
0CBF   F2 C7 0C               JP   NegateIfPositive   ; 
0CC2   CD 05 08               CALL   FAddOneHalf   ; 
0CC5   EF                     RST   05   ; 
0CC6   B7                     ORA   A   ;resets carry (ie later negate)
0CC7   F5           NEGATEIFPOSITIVE:   PUSH   PSW   ; 
0CC8   F4 FE 09               CP   FNegate   ; 
0CCB   01 00 7F               LXI   B,7F00h   ;CDE=0.25
0CCE   51                     MOV   D,C   ; 
0CCF   59                     MOV   E,C   ; 
0CD0   CD 16 08               CALL   FAdd+2   ; 
0CD3   F1                     POP   PSW   ; 
0CD4   D4 FE 09               CNC   FNegate   ; 
0CD7   CD 06 0A               CALL   FPush   ; 
0CDA   CD 21 0A               CALL   FCopyToBCDE   ; 
0CDD   CD E9 08               CALL   FMul+2   ; = x*x
0CE0   CD 06 0A               CALL   FPush   ;ush x*x
0CE3   21 07 0D               LXI   H,TAYLOR_SERIES   ; 
0CE6   CD 13 0A               CALL   FLoadFromMem   ; 
0CE9   C1                     POP   B   ; 
0CEA   D1                     POP   D   ; 
0CEB   3E 04                  MVI   A,04h   ; 
0CED   F5           TAYLORLOOP:   PUSH   PSW   ;ush #terms remaining
0CEE   D5                     PUSH   D   ;ush BCDE
0CEF   C5                     PUSH   B   ; 
0CF0   E5                     PUSH   H   ; 
0CF1   CD E9 08               CALL   FMul+2   ; 
0CF4   E1                     POP   H   ; 
0CF5   CD 24 0A               CALL   FLoadBCDEfromMem   ; 
0CF8   E5                     PUSH   H   ; 
0CF9   CD 16 08               CALL   FAdd+2   ; 
0CFC   E1                     POP   H   ; 
0CFD   C1                     POP   B   ; 
0CFE   D1                     POP   D   ; 
0CFF   F1                     POP   PSW   ;op #terms remaining into A.
0D00   3D                     DCR   A   ;ecrement #terms and loop back if not
0D01   C2 ED 0C               JNZ   TaylorLoop   ;one all 4 of them.
0D04   C3 E7 08               JMP   FMul   ; 
0D07   BA D7 1E 86  TAYLOR_SERIES:   DB   0xBA,0xD7,0x1E,0x86   ;DD 39.710670	
0D0B   64 26 99 87            DB   0x64,0x26,0x99,0x87   ;DD -76.574982	
0D0F   58 34 23 87            DB   0x58,0x34,0x23,0x87   ;DD 81.602234	
0D13   E0 5D A5 86            DB   0xE0,0x5D,0xA5,0x86   ;DD -41.341675	
0D17   DA 0F 49 83            DB   0xDA,0x0F,0x49,0x83   ;DD 6.283185	
0D1B   00 00 00 00 00 00 00 00 00 00 L0D17:   DB   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00   ;   DD 6.283185
0D25   21 1A 0F     INIT:     LXI   H,STK_TOP   ; *** STACK_TOP RELOCATE
0D28   F9                     SPHL      ; 
0D29   22 63 01               SHLD   STACK_TOP   ; ld (STACK_TOP),hl
0D2C   DB 18                  IN   UART_RX   ; flush RX buffer
0D2E   0E FF                  MVI   C,0xFF   ; ld c,$ff
0D30                             ;	JMP ConfigIOcode
0D30   21 FF FF     CONFIGIOCODE:   LXI   H,0xFFFF   ; 
0D33   22 61 01               SHLD   CURRENT_LINE   ; ld (CURRENT_LINE),hl
0D36   CD 98 05               CALL   NewLine   ; 
0D39   21 73 0E               LXI   H,szMemorySize   ; 
0D3C   CD A7 05               CALL   PrintString   
0D3F   CD C2 02               CALL   InputLineWith   
0D42   D7                     RST   02   ;RST NextChar	
0D43   B7                     ORA   A   
0D44   C2 61 0D               JNZ   L0DDE   
0D47   21 7F 0E               LXI   H,UnusedMemory   
0D4A   23           FINDMEMTOPLOOP:   INX   H   
0D4B   7C                     MOV   A,H   ; check if we've reached A0
0D4C   FE A0                  CPI   0xa0   
0D4E   CA 6D 0D               JZ   DoneMemSize   ; if yes, then exit loop with HL=a000
0D51   3E 37                  MVI   A,37h   
0D53   77                     MOV   M,A   
0D54   BE                     CMP   M   
0D55   C2 6D 0D               JNZ   DoneMemSize   
0D58   3D                     DCR   A   
0D59   77                     MOV   M,A   
0D5A   BE                     CMP   M   
0D5B   CA 4A 0D               JZ   FindMemTopLoop   
0D5E   C3 6D 0D               JMP   DoneMemSize   
0D61   21 13 01     L0DDE:    LXI   H,LINE_BUFFER   
0D64   CD AB 04               CALL   LineNumberFromStr   
0D67   B7                     ORA   A   
0D68   C2 D0 01               JNZ   SyntaxError   
0D6B   EB                     XCHG      
0D6C   2B                     DCX   H   
0D6D   2B           DONEMEMSIZE:   DCX   H   
0D6E   E5                     PUSH   H   
0D6F   21 37 0E     GETTERMINALWIDTH:   LXI   H,szTerminalWidth   
0D72   CD A7 05               CALL   PrintString   
0D75   CD C2 02               CALL   InputLineWith   
0D78   D7                     RST   02   ;RST NextChar	
0D79   B7                     ORA   A   
0D7A   CA 9E 0D               JZ   DoOptionalFns   
0D7D   21 13 01               LXI   H,LINE_BUFFER   
0D80   CD AB 04               CALL   LineNumberFromStr   
0D83   7A                     MOV   A,D   
0D84   B7                     ORA   A   
0D85   C2 6F 0D               JNZ   GetTerminalWidth   
0D88   7B                     MOV   A,E   
0D89   FE 10                  CPI   0x10   
0D8B   DA 6F 0D               JC   GetTerminalWidth   
0D8E   32 6F 03               STA   OutChar_tail+1   
0D91   D6 0E        CALCTABBRKSIZE:   SUI   0Eh   
0D93   D2 91 0D               JNC   CalcTabBrkSize   
0D96   C6 1C                  ADI   1Ch   
0D98   2F                     CMA      
0D99   3C                     INR   A   
0D9A   83                     ADD   E   
0D9B   32 BB 05               STA   ToNextTabBreak+4   
0D9E   21 08 0E     DOOPTIONALFNS:   LXI   H,OPT_FN_DESCS   
0DA1   F7           OPTIONALFNSLOOP:   RST   6   
0DA2   11 1C 0E               LXI   D,szWantSin   
0DA5   E7                     RST   4   
0DA6   CA B5 0D               JZ   L0E32   
0DA9   F7                     RST   6   
0DAA   E3                     XTHL      
0DAB   CD A7 05               CALL   PrintString   
0DAE   CD C2 02               CALL   InputLineWith   
0DB1   D7                     RST   02   ;RST NextChar	
0DB2   E1                     POP   H   
0DB3   FE 59                  CPI   "Y"   
0DB5   D1           L0E32:    POP   D   
0DB6   CA CA 0D               JZ   InitProgramBase   
0DB9   FE 4E                  CPI   "N"   
0DBB   C2 9E 0D               JNZ   DoOptionalFns   
0DBE   F7                     RST   6   
0DBF   E3                     XTHL      
0DC0   11 A6 04               LXI   D,FunctionCallError   
0DC3   73                     MOV   M,E   
0DC4   23                     INX   H   
0DC5   72                     MOV   M,D   
0DC6   E1                     POP   H   
0DC7   C3 A1 0D               JMP   OptionalFnsLoop   
0DCA   EB           INITPROGRAMBASE:   XCHG      
0DCB   36 00                  MVI   M,00h   
0DCD   23                     INX   H   
0DCE   22 65 01               SHLD   PROGRAM_BASE   
0DD1   E3                     XTHL      
0DD2   11 1A 0F               LXI   D,STK_TOP   ; *** RELOCATE STACK_TOP	
0DD5   E7                     RST   4   
0DD6   DA CD 01               JC   OutOfMemory   
0DD9   D1                     POP   D   
0DDA   F9                     SPHL      
0DDB   22 63 01               SHLD   STACK_TOP   
0DDE   EB                     XCHG      
0DDF   CD C3 01               CALL   CheckEnoughMem   
0DE2   7B                     MOV   A,E   
0DE3   95                     SUB   L   
0DE4   6F                     MOV   L,A   
0DE5   7A                     MOV   A,D   
0DE6   9C                     SBB   H   
0DE7   67                     MOV   H,A   
0DE8   01 F0 FF               LXI   B,0xFFF0   
0DEB   09                     DAD   B   
0DEC   CD 98 05               CALL   NewLine   
0DEF   CD 3B 0B               CALL   PrintInt   
0DF2   21 46 0E               LXI   H,szVersionInfo   
0DF5   CD A7 05               CALL   PrintString   
0DF8   21 A7 05               LXI   H,PrintString   
0DFB   22 FD 01               SHLD   Main+4   
0DFE   CD 96 02               CALL   New+1   
0E01   21 F9 01               LXI   H,Main   
0E04   22 02 00               SHLD   Start+2   
0E07   E9                     PCHL      
0E08   1B 0D        OPT_FN_DESCS:   DW   L0D17   
0E0A   1C 0E                  DW   szWantSin   
0E0C   49 00                  DW   KW_INLINE_FNS+12   
0E0E   99 0C                  DW   Sin   
0E10   25 0E                  DW   szWantRnd   
0E12   47 00                  DW   KW_INLINE_FNS+10   
0E14   63 0C                  DW   Rnd   
0E16   2E 0E                  DW   szWantSqr   
0E18   45 00                  DW   KW_INLINE_FNS+8   
0E1A   25 0C                  DW   Sqr   
0E1C   57 41 4E 54 20 53 49 CE 00 SZWANTSIN:   DB   57h,41h,4Eh,54h,20h,53h,49h,0CEh,00h   ; DS "WANT SIN\0"
0E25   57 41 4E 54 20 52 4E C4 00 SZWANTRND:   DB   57h,41h,4Eh,54h,20h,52h,4Eh,0C4h,00h   ; DS "WANT RND\0"
0E2E   57 41 4E 54 20 53 51 D2 00 SZWANTSQR:   DB   57h,41h,4Eh,54h,20h,53h,51h,0D2h,00h   ; DS "WANT SQR\0"
0E37   54 45 52 4D 49 4E 41 4C 20 57 49 44 54 C8 00 SZTERMINALWIDTH:   DB   54h,45h,52h,4Dh,49h,4Eh,41h,4Ch,20h,57h,49h,44h,54h,0C8h,00h   ; DS "TERMINAL WIDTH\0"
0E46   20 42 59 54 45 53 20 46 52 45 C5 0D 0D SZVERSIONINFO:   DB   0x20,0x42,0x59,0x54,0x45,0x53,0x20,0x46,0x52,0x45,0xC5,0x0D,0x0D   ; DS " BYTES FREE\r\r"
0E53   42 41 53 49 43 20 56 45 52 53 49 4F 4E 20 33 2E DB   0x42,0x41,0x53,0x49,0x43,0x20,0x56,0x45,0x52,0x53,0x49,0x4F,0x4E,0x20,0x33,0x2E   ; "BASIC VERSION 3."
0E63   B2 0D 5B 34 4B 20 56 45 52 53 49 4F 4E DD 0D 00 DB   0xB2,0x0D,0x5B,0x34,0x4B,0x20,0x56,0x45,0x52,0x53,0x49,0x4F,0x4E,0xDD,0x0D,0x00   ; "2\r[4K VERSION]\r\0"
0E73   4D 45 4D 4F 52 59 20 53 49 5A C5 00 SZMEMORYSIZE:   DB   0x4D,0x45,0x4D,0x4F,0x52,0x59,0x20,0x53,0x49,0x5A,0xC5,0x00   ; DS "MEMORY SIZE\0"
0E7F   00           UNUSEDMEMORY:   DB   00   


UART_RX:            0018 DEFINED AT LINE 9
                    > USED AT LINE 517
                    > USED AT LINE 2006
UART_TX:            0018 DEFINED AT LINE 10
                    > USED AT LINE 510
UART_RX_STATUS:     0019 DEFINED AT LINE 11
                    > USED AT LINE 513
                    > USED AT LINE 514
                    > USED AT LINE 662
                    > USED AT LINE 663
UART_TX_STATUS:     0019 DEFINED AT LINE 12
                    > USED AT LINE 504
                    > USED AT LINE 505
UART_RX_FULL:       0001 DEFINED AT LINE 13
                    > USED AT LINE 515
                    > USED AT LINE 664
UART_TX_EMPTY:      0004 DEFINED AT LINE 14
                    > USED AT LINE 506
STK_TOP:            0F1A DEFINED AT LINE 16
                    > USED AT LINE 186
                    > USED AT LINE 2003
                    > USED AT LINE 2097
MEM_TOP:            2000 DEFINED AT LINE 17
START:              0000 DEFINED AT LINE 21
                    > USED AT LINE 2121
SYNTAXCHECK:        0008 DEFINED AT LINE 28
NEXTCHAR:           0010 DEFINED AT LINE 36
                    > USED AT LINE 649
OUTCHAR:            0018 DEFINED AT LINE 43
COMPAREHLDE:        0020 DEFINED AT LINE 49
TERMINAL_Y:         0026 DEFINED AT LINE 55
TERMINAL_X:         0027 DEFINED AT LINE 56
                    > USED AT LINE 44
                    > USED AT LINE 502
                    > USED AT LINE 823
                    > USED AT LINE 829
                    > USED AT LINE 854
                    > USED AT LINE 867
FTESTSIGN:          0028 DEFINED AT LINE 59
                    > USED AT LINE 1600
PUSHNEXTWORD:       0030 DEFINED AT LINE 65
L003A:              003A DEFINED AT LINE 73
                    > USED AT LINE 66
                    > USED AT LINE 73
KW_INLINE_FNS:      003D DEFINED AT LINE 75
                    > USED AT LINE 1046
                    > USED AT LINE 2126
                    > USED AT LINE 2129
                    > USED AT LINE 2132
KW_ARITH_OP_FNS:    004B DEFINED AT LINE 83
                    > USED AT LINE 991
KEYWORDS:           0057 DEFINED AT LINE 92
                    > USED AT LINE 416
                    > USED AT LINE 548
KW_GENERAL_FNS:     00D2 DEFINED AT LINE 136
                    > USED AT LINE 639
ERROR_CODES:        00FA DEFINED AT LINE 157
                    > USED AT LINE 249
LINE_BUFFER:        0113 DEFINED AT LINE 171
                    > USED AT LINE 324
                    > USED AT LINE 405
                    > USED AT LINE 462
                    > USED AT LINE 475
                    > USED AT LINE 821
                    > USED AT LINE 2033
                    > USED AT LINE 2049
DIM_OR_EVAL:        015B DEFINED AT LINE 181
                    > USED AT LINE 1059
                    > USED AT LINE 1128
                    > USED AT LINE 1134
                    > USED AT LINE 1157
                    > USED AT LINE 1177
INPUT_OR_READ:      015C DEFINED AT LINE 182
                    > USED AT LINE 893
                    > USED AT LINE 906
                    > USED AT LINE 921
PROG_PTR_TEMP:      015D DEFINED AT LINE 183
                    > USED AT LINE 384
                    > USED AT LINE 396
                    > USED AT LINE 604
                    > USED AT LINE 754
                    > USED AT LINE 939
                    > USED AT LINE 970
TEMP2:              015F DEFINED AT LINE 184
                    > USED AT LINE 978
                    > USED AT LINE 979
                    > USED AT LINE 1005
CURRENT_LINE:       0161 DEFINED AT LINE 185
                    > USED AT LINE 260
                    > USED AT LINE 271
                    > USED AT LINE 577
                    > USED AT LINE 625
                    > USED AT LINE 712
                    > USED AT LINE 735
                    > USED AT LINE 881
                    > USED AT LINE 965
                    > USED AT LINE 2011
STACK_TOP:          0163 DEFINED AT LINE 186
                    > USED AT LINE 390
                    > USED AT LINE 2005
                    > USED AT LINE 2102
PROGRAM_BASE:       0165 DEFINED AT LINE 187
                    > USED AT LINE 353
                    > USED AT LINE 374
                    > USED AT LINE 382
                    > USED AT LINE 656
                    > USED AT LINE 2095
VAR_BASE:           0167 DEFINED AT LINE 188
                    > USED AT LINE 294
                    > USED AT LINE 303
                    > USED AT LINE 307
                    > USED AT LINE 314
                    > USED AT LINE 380
                    > USED AT LINE 386
                    > USED AT LINE 1074
VAR_ARRAY_BASE:     0169 DEFINED AT LINE 189
                    > USED AT LINE 387
                    > USED AT LINE 1072
                    > USED AT LINE 1111
                    > USED AT LINE 1140
VAR_TOP:            016B DEFINED AT LINE 190
                    > USED AT LINE 227
                    > USED AT LINE 388
                    > USED AT LINE 1101
                    > USED AT LINE 1108
                    > USED AT LINE 1146
                    > USED AT LINE 1194
DATA_PROG_PTR:      016D DEFINED AT LINE 191
                    > USED AT LINE 658
                    > USED AT LINE 890
FACCUM:             016F DEFINED AT LINE 192
                    > USED AT LINE 59
                    > USED AT LINE 679
                    > USED AT LINE 1124
                    > USED AT LINE 1217
                    > USED AT LINE 1236
                    > USED AT LINE 1279
                    > USED AT LINE 1285
                    > USED AT LINE 1385
                    > USED AT LINE 1475
                    > USED AT LINE 1484
                    > USED AT LINE 1503
                    > USED AT LINE 1513
                    > USED AT LINE 1517
                    > USED AT LINE 1528
                    > USED AT LINE 1538
                    > USED AT LINE 1544
                    > USED AT LINE 1547
                    > USED AT LINE 1554
                    > USED AT LINE 1557
                    > USED AT LINE 1560
                    > USED AT LINE 1570
                    > USED AT LINE 1579
                    > USED AT LINE 1606
                    > USED AT LINE 1662
                    > USED AT LINE 1886
FTEMP:              0173 DEFINED AT LINE 193
                    > USED AT LINE 1328
FBUFFER:            0174 DEFINED AT LINE 194
                    > USED AT LINE 1759
                    > USED AT LINE 1894
                    > USED AT LINE 1899
SZERROR:            0181 DEFINED AT LINE 197
                    > USED AT LINE 258
SZIN:               0188 DEFINED AT LINE 198
                    > USED AT LINE 1750
SZOK:               018D DEFINED AT LINE 199
                    > USED AT LINE 268
GETFLOWPTR:         0192 DEFINED AT LINE 201
                    > USED AT LINE 214
                    > USED AT LINE 565
                    > USED AT LINE 729
                    > USED AT LINE 940
COPYMEMORYUP:       01A7 DEFINED AT LINE 215
                    > USED AT LINE 312
                    > USED AT LINE 1106
COPYMEMLOOP:        01AD DEFINED AT LINE 219
                    > USED AT LINE 225
CHECKENOUGHVARSPACE: 01B6 DEFINED AT LINE 226
                    > USED AT LINE 572
                    > USED AT LINE 708
                    > USED AT LINE 976
CHECKENOUGHMEM:     01C3 DEFINED AT LINE 234
                    > USED AT LINE 215
                    > USED AT LINE 231
                    > USED AT LINE 1193
                    > USED AT LINE 2104
OUTOFMEMORY:        01CD DEFINED AT LINE 242
                    > USED AT LINE 2099
SYNTAXERROR:        01D0 DEFINED AT LINE 244
                    > USED AT LINE 33
                    > USED AT LINE 614
                    > USED AT LINE 634
                    > USED AT LINE 692
                    > USED AT LINE 776
                    > USED AT LINE 905
                    > USED AT LINE 1062
                    > USED AT LINE 2036
DIVIDEBYZERO:       01D3 DEFINED AT LINE 246
                    > USED AT LINE 1413
ERROR:              01D5 DEFINED AT LINE 247
                    > USED AT LINE 683
                    > USED AT LINE 726
                    > USED AT LINE 733
                    > USED AT LINE 886
                    > USED AT LINE 931
                    > USED AT LINE 948
                    > USED AT LINE 1160
                    > USED AT LINE 1166
                    > USED AT LINE 1315
STOP:               01F7 DEFINED AT LINE 266
                    > USED AT LINE 136
                    > USED AT LINE 151
                    > USED AT LINE 668
MAIN:               01F9 DEFINED AT LINE 268
                    > USED AT LINE 530
                    > USED AT LINE 620
                    > USED AT LINE 2118
                    > USED AT LINE 2120
GETNONBLANKLINE:    01FF DEFINED AT LINE 270
                    > USED AT LINE 276
                    > USED AT LINE 340
STOREPROGRAMLINE:   021C DEFINED AT LINE 285
REMOVEPROGRAMLINE:  0228 DEFINED AT LINE 293
REMOVELINE:         022C DEFINED AT LINE 295
                    > USED AT LINE 300
INSERTPROGRAMLINE:  0239 DEFINED AT LINE 304
                    > USED AT LINE 292
COPYFROMBUFFER:     0255 DEFINED AT LINE 324
                    > USED AT LINE 330
UPDATELINKEDLIST:   0260 DEFINED AT LINE 331
                    > USED AT LINE 306
L0265:              0265 DEFINED AT LINE 335
                    > USED AT LINE 352
L0271:              0271 DEFINED AT LINE 345
                    > USED AT LINE 347
FINDPROGRAMLINE:    027D DEFINED AT LINE 353
                    > USED AT LINE 290
                    > USED AT LINE 372
                    > USED AT LINE 523
                    > USED AT LINE 720
NEW:                0295 DEFINED AT LINE 373
                    > USED AT LINE 155
                    > USED AT LINE 2119
RUN:                02A1 DEFINED AT LINE 381
                    > USED AT LINE 145
RESETALL:           02A2 DEFINED AT LINE 382
                    > USED AT LINE 331
CLEAR:              02A6 DEFINED AT LINE 384
                    > USED AT LINE 154
RESETSTACK:         02B5 DEFINED AT LINE 389
                    > USED AT LINE 247
INPUTLINEWITH:      02C2 DEFINED AT LINE 398
                    > USED AT LINE 887
                    > USED AT LINE 912
                    > USED AT LINE 2015
                    > USED AT LINE 2045
                    > USED AT LINE 2075
TOKENIZE:           02CC DEFINED AT LINE 404
                    > USED AT LINE 280
                    > USED AT LINE 441
KWCOMPARE:          02E9 DEFINED AT LINE 419
                    > USED AT LINE 428
                    > USED AT LINE 461
NOTAKEYWORD:        02FF DEFINED AT LINE 433
                    > USED AT LINE 423
WRITECHAR:          0302 DEFINED AT LINE 436
                    > USED AT LINE 408
                    > USED AT LINE 447
FREECOPYLOOP:       030C DEFINED AT LINE 443
                    > USED AT LINE 452
FREECOPY:           0315 DEFINED AT LINE 448
                    > USED AT LINE 411
NEXTKEYWORD:        031C DEFINED AT LINE 453
                    > USED AT LINE 425
NEXTKWLOOP:         0320 DEFINED AT LINE 457
                    > USED AT LINE 459
EXIT:               0329 DEFINED AT LINE 462
                    > USED AT LINE 413
                    > USED AT LINE 445
BACKSPACE:          0332 DEFINED AT LINE 469
                    > USED AT LINE 487
RESETINPUT:         0338 DEFINED AT LINE 473
                    > USED AT LINE 485
INPUTLINE:          033C DEFINED AT LINE 475
                    > USED AT LINE 272
                    > USED AT LINE 402
INPUTNEXT:          0341 DEFINED AT LINE 477
                    > USED AT LINE 472
                    > USED AT LINE 481
                    > USED AT LINE 483
                    > USED AT LINE 498
L036A:              036A DEFINED AT LINE 497
                    > USED AT LINE 492
OUTCHAR_TAIL:       036E DEFINED AT LINE 499
                    > USED AT LINE 45
                    > USED AT LINE 2057
WAITTERMREADY:      0377 DEFINED AT LINE 503
                    > USED AT LINE 507
INPUTCHAR:          0388 DEFINED AT LINE 512
                    > USED AT LINE 477
                    > USED AT LINE 516
                    > USED AT LINE 666
LIST:               0398 DEFINED AT LINE 520
                    > USED AT LINE 153
LISTNEXTLINE:       03A1 DEFINED AT LINE 525
                    > USED AT LINE 543
LISTCHAR:           03B8 DEFINED AT LINE 539
                    > USED AT LINE 544
                    > USED AT LINE 559
TONEXTKEYWORD:      03CA DEFINED AT LINE 550
                    > USED AT LINE 553
                    > USED AT LINE 556
PRINTKEYWORD:       03D5 DEFINED AT LINE 557
                    > USED AT LINE 562
FOR:                03DF DEFINED AT LINE 563
                    > USED AT LINE 137
L03E2:              03EC DEFINED AT LINE 570
                    > USED AT LINE 567
PUSHSTEPVALUE:      041E DEFINED AT LINE 599
                    > USED AT LINE 593
ENDOFFORHANDLER:    0427 DEFINED AT LINE 606
                    > USED AT LINE 968
EXECNEXT:           042B DEFINED AT LINE 609
                    > USED AT LINE 628
                    > USED AT LINE 736
                    > USED AT LINE 971
EXEC:               0448 DEFINED AT LINE 627
                    > USED AT LINE 284
                    > USED AT LINE 612
                    > USED AT LINE 796
NEXTCHAR_TAIL:      0468 DEFINED AT LINE 648
                    > USED AT LINE 40
RESTORE:            0473 DEFINED AT LINE 655
                    > USED AT LINE 147
                    > USED AT LINE 385
L046E:              0478 DEFINED AT LINE 658
                    > USED AT LINE 925
TESTBREAKKEY:       047D DEFINED AT LINE 661
                    > USED AT LINE 531
                    > USED AT LINE 609
CHARISALPHA:        048E DEFINED AT LINE 669
                    > USED AT LINE 1009
                    > USED AT LINE 1061
GETSUBSCRIPT:       0496 DEFINED AT LINE 675
                    > USED AT LINE 862
                    > USED AT LINE 1130
FUNCTIONCALLERROR:  04A6 DEFINED AT LINE 682
                    > USED AT LINE 78
                    > USED AT LINE 678
                    > USED AT LINE 1884
                    > USED AT LINE 2085
LINENUMBERFROMSTR:  04AB DEFINED AT LINE 684
                    > USED AT LINE 278
                    > USED AT LINE 520
                    > USED AT LINE 718
                    > USED AT LINE 2034
                    > USED AT LINE 2050
NEXTLINENUMCHAR:    04AF DEFINED AT LINE 686
                    > USED AT LINE 706
GOSUB:              04CC DEFINED AT LINE 707
                    > USED AT LINE 148
GOTO:               04DD DEFINED AT LINE 718
                    > USED AT LINE 144
                    > USED AT LINE 795
RETURN:             04ED DEFINED AT LINE 727
                    > USED AT LINE 149
FINDNEXTSTATEMENT:  0503 DEFINED AT LINE 738
                    > USED AT LINE 139
                    > USED AT LINE 574
REM:                0505 DEFINED AT LINE 739
                    > USED AT LINE 150
                    > USED AT LINE 793
FINDNEXTSTATEMENTLOOP: 0507 DEFINED AT LINE 741
                    > USED AT LINE 747
LET:                0510 DEFINED AT LINE 748
                    > USED AT LINE 143
                    > USED AT LINE 563
                    > USED AT LINE 632
ASSIGNVAR:          0515 DEFINED AT LINE 751
                    > USED AT LINE 915
IFL:                0524 DEFINED AT LINE 760
                    > USED AT LINE 146
GETCOMPAREOPLOOP:   052D DEFINED AT LINE 764
                    > USED AT LINE 773
GOTCOMPAREOP:       0540 DEFINED AT LINE 774
                    > USED AT LINE 765
                    > USED AT LINE 767
PRINT:              0565 DEFINED AT LINE 799
                    > USED AT LINE 152
                    > USED AT LINE 803
                    > USED AT LINE 819
                    > USED AT LINE 879
TERMINATEINPUT:     0593 DEFINED AT LINE 820
                    > USED AT LINE 479
NEWLINE:            0598 DEFINED AT LINE 822
                    > USED AT LINE 248
                    > USED AT LINE 474
                    > USED AT LINE 500
                    > USED AT LINE 533
                    > USED AT LINE 799
                    > USED AT LINE 852
                    > USED AT LINE 856
                    > USED AT LINE 2012
                    > USED AT LINE 2113
PRINTSTRING:        05A7 DEFINED AT LINE 844
                    > USED AT LINE 259
                    > USED AT LINE 802
                    > USED AT LINE 815
                    > USED AT LINE 853
                    > USED AT LINE 1751
                    > USED AT LINE 1757
                    > USED AT LINE 2014
                    > USED AT LINE 2044
                    > USED AT LINE 2074
                    > USED AT LINE 2116
                    > USED AT LINE 2117
TONEXTTABBREAK:     05B7 DEFINED AT LINE 854
                    > USED AT LINE 808
                    > USED AT LINE 2065
CALCSPACECOUNT:     05C2 DEFINED AT LINE 858
                    > USED AT LINE 859
TAB:                05CB DEFINED AT LINE 862
                    > USED AT LINE 805
PRINTSPACES:        05DA DEFINED AT LINE 871
                    > USED AT LINE 861
PRINTSPACELOOP:     05DE DEFINED AT LINE 874
                    > USED AT LINE 876
EXITTAB:            05E3 DEFINED AT LINE 877
                    > USED AT LINE 810
                    > USED AT LINE 857
                    > USED AT LINE 870
INPUT:              05E8 DEFINED AT LINE 880
                    > USED AT LINE 140
READ:               05FA DEFINED AT LINE 889
                    > USED AT LINE 142
L05FA:              05FE DEFINED AT LINE 891
                    > USED AT LINE 888
READNEXT:           0605 DEFINED AT LINE 896
                    > USED AT LINE 919
GOTDATAITEM:        0624 DEFINED AT LINE 913
                    > USED AT LINE 903
                    > USED AT LINE 937
NEXTDATALINE:       0639 DEFINED AT LINE 926
                    > USED AT LINE 909
                    > USED AT LINE 935
NEXT:               064D DEFINED AT LINE 938
                    > USED AT LINE 138
FORLOOPISCOMPLETE:  0687 DEFINED AT LINE 969
                    > USED AT LINE 963
EVALEXPRESSION:     068E DEFINED AT LINE 972
                    > USED AT LINE 581
                    > USED AT LINE 594
                    > USED AT LINE 676
                    > USED AT LINE 752
                    > USED AT LINE 760
                    > USED AT LINE 778
                    > USED AT LINE 812
                    > USED AT LINE 1006
                    > USED AT LINE 1021
ARITHPARSE:         069D DEFINED AT LINE 979
                    > USED AT LINE 999
EVALTERM:           06C8 DEFINED AT LINE 1007
                    > USED AT LINE 977
                    > USED AT LINE 1012
                    > USED AT LINE 1025
EVALBRACKETED:      06E6 DEFINED AT LINE 1019
                    > USED AT LINE 1042
EVALMINUSTERM:      06EE DEFINED AT LINE 1025
                    > USED AT LINE 1016
POPRET:             06F5 DEFINED AT LINE 1028
                    > USED AT LINE 1044
EVALVARTERM:        06F7 DEFINED AT LINE 1031
                    > USED AT LINE 1010
                    > USED AT LINE 1093
EVALINLINEFN:       0701 DEFINED AT LINE 1037
                    > USED AT LINE 1018
DIMCONTD:           0715 DEFINED AT LINE 1050
                    > USED AT LINE 1055
DIM:                071A DEFINED AT LINE 1055
                    > USED AT LINE 141
GETVAR:             071F DEFINED AT LINE 1058
                    > USED AT LINE 748
                    > USED AT LINE 898
                    > USED AT LINE 938
                    > USED AT LINE 1031
L072E:              0732 DEFINED AT LINE 1069
                    > USED AT LINE 1066
FINDVARLOOP:        073F DEFINED AT LINE 1075
                    > USED AT LINE 1089
NOTIT:              074B DEFINED AT LINE 1083
                    > USED AT LINE 1080
ALLOCNEWVAR:        0756 DEFINED AT LINE 1090
                    > USED AT LINE 1076
INITVARLOOP:        077A DEFINED AT LINE 1112
                    > USED AT LINE 1115
FINPTR:             0786 DEFINED AT LINE 1121
                    > USED AT LINE 1084
ALREADYALLOCD:      0789 DEFINED AT LINE 1124
                    > USED AT LINE 1096
GETARRAYVAR:        078E DEFINED AT LINE 1127
                    > USED AT LINE 1070
FINDARRAY:          07A5 DEFINED AT LINE 1142
                    > USED AT LINE 1156
L07BF:              07C3 DEFINED AT LINE 1161
                    > USED AT LINE 1200
ALLOCARRAY:         07D1 DEFINED AT LINE 1172
                    > USED AT LINE 1150
NOTDIM:             07E5 DEFINED AT LINE 1186
                    > USED AT LINE 1179
INITELEMENTS:       07F3 DEFINED AT LINE 1196
                    > USED AT LINE 1199
FWORDTOFLOAT:       07FD DEFINED AT LINE 1201
FADDONEHALF:        0805 DEFINED AT LINE 1205
                    > USED AT LINE 1787
                    > USED AT LINE 1960
FADDMEM:            0808 DEFINED AT LINE 1206
                    > USED AT LINE 952
FSUB:               080E DEFINED AT LINE 1208
                    > USED AT LINE 86
                    > USED AT LINE 1952
                    > USED AT LINE 1956
FADD:               0814 DEFINED AT LINE 1212
                    > USED AT LINE 84
                    > USED AT LINE 1207
                    > USED AT LINE 1512
                    > USED AT LINE 1735
                    > USED AT LINE 1904
                    > USED AT LINE 1928
                    > USED AT LINE 1968
                    > USED AT LINE 1988
L082C:              0830 DEFINED AT LINE 1230
                    > USED AT LINE 1221
FSUBMANTISSAS:      0851 DEFINED AT LINE 1245
                    > USED AT LINE 1237
FNORMALISE:         085F DEFINED AT LINE 1259
                    > USED AT LINE 1380
                    > USED AT LINE 1535
                    > USED AT LINE 1670
                    > USED AT LINE 1937
NORMLOOP:           0869 DEFINED AT LINE 1264
                    > USED AT LINE 1277
FNORMX:             0879 DEFINED AT LINE 1279
FROUNDUP:           0882 DEFINED AT LINE 1284
                    > USED AT LINE 1239
                    > USED AT LINE 1244
                    > USED AT LINE 1263
                    > USED AT LINE 1460
FMANTISSALEFT:      0894 DEFINED AT LINE 1295
                    > USED AT LINE 1270
                    > USED AT LINE 1462
FMANTISSAINC:       089E DEFINED AT LINE 1305
                    > USED AT LINE 1287
                    > USED AT LINE 1650
OVERFLOW:           08A8 DEFINED AT LINE 1314
                    > USED AT LINE 1242
                    > USED AT LINE 1479
                    > USED AT LINE 1501
                    > USED AT LINE 1510
                    > USED AT LINE 1516
FADDMANTISSAS:      08AD DEFINED AT LINE 1316
                    > USED AT LINE 1238
                    > USED AT LINE 1828
FNEGATEINT:         08B9 DEFINED AT LINE 1328
                    > USED AT LINE 1259
                    > USED AT LINE 1652
FMANTISSARTMULT:    08CD DEFINED AT LINE 1346
                    > USED AT LINE 1234
                    > USED AT LINE 1647
RTMULTLOOP:         08D1 DEFINED AT LINE 1349
                    > USED AT LINE 1353
FMANTISSARTONCE:    08DA DEFINED AT LINE 1354
                    > USED AT LINE 1243
                    > USED AT LINE 1352
                    > USED AT LINE 1400
FMUL:               08E7 DEFINED AT LINE 1367
                    > USED AT LINE 88
                    > USED AT LINE 1908
                    > USED AT LINE 1925
                    > USED AT LINE 1973
                    > USED AT LINE 1984
                    > USED AT LINE 1995
FMULOUTERLOOP:      0909 DEFINED AT LINE 1386
                    > USED AT LINE 1382
FMULINNERLOOP:      090E DEFINED AT LINE 1390
                    > USED AT LINE 1374
                    > USED AT LINE 1376
                    > USED AT LINE 1403
L0919:              091D DEFINED AT LINE 1400
                    > USED AT LINE 1393
POPHLANDRETURN:     0925 DEFINED AT LINE 1404
                    > USED AT LINE 1494
FDIVBYTEN:          0927 DEFINED AT LINE 1406
                    > USED AT LINE 1708
                    > USED AT LINE 1782
FDIV:               0933 DEFINED AT LINE 1410
                    > USED AT LINE 90
                    > USED AT LINE 1901
                    > USED AT LINE 1947
FDIVLOOP:           0958 DEFINED AT LINE 1434
                    > USED AT LINE 1473
                    > USED AT LINE 1478
FDIVC:              095B DEFINED AT LINE 1437
                    > USED AT LINE 1426
FDIVB:              095F DEFINED AT LINE 1440
                    > USED AT LINE 1423
FDIVA:              0963 DEFINED AT LINE 1443
                    > USED AT LINE 1420
FDIVG:              0966 DEFINED AT LINE 1445
                    > USED AT LINE 1433
                    > USED AT LINE 1449
                    > USED AT LINE 1467
                    > USED AT LINE 1469
FDIV2:              0975 DEFINED AT LINE 1454
                    > USED AT LINE 1448
FEXPONENTADD:       099F DEFINED AT LINE 1480
                    > USED AT LINE 1372
                    > USED AT LINE 1415
MULDV1:             09BD DEFINED AT LINE 1499
                    > USED AT LINE 1491
MULDV2:             09BE DEFINED AT LINE 1500
                    > USED AT LINE 1482
FZERO:              09C2 DEFINED AT LINE 1502
                    > USED AT LINE 1265
                    > USED AT LINE 1282
                    > USED AT LINE 1672
FMULBYTEN:          09C7 DEFINED AT LINE 1505
                    > USED AT LINE 1716
                    > USED AT LINE 1728
FTESTSIGN_TAIL:     09DE DEFINED AT LINE 1517
                    > USED AT LINE 61
INVSIGNTOINT:       09E2 DEFINED AT LINE 1519
                    > USED AT LINE 1601
SIGNTOINT:          09E3 DEFINED AT LINE 1520
SGN:                09E8 DEFINED AT LINE 1525
                    > USED AT LINE 75
FCHARTOFLOAT:       09E9 DEFINED AT LINE 1526
                    > USED AT LINE 1204
                    > USED AT LINE 1732
                    > USED AT LINE 1756
ABS:                09FC DEFINED AT LINE 1536
                    > USED AT LINE 77
FNEGATE:            09FE DEFINED AT LINE 1538
                    > USED AT LINE 1027
                    > USED AT LINE 1210
                    > USED AT LINE 1769
                    > USED AT LINE 1964
                    > USED AT LINE 1970
FPUSH:              0A06 DEFINED AT LINE 1543
                    > USED AT LINE 762
                    > USED AT LINE 1002
                    > USED AT LINE 1225
                    > USED AT LINE 1406
                    > USED AT LINE 1731
                    > USED AT LINE 1898
                    > USED AT LINE 1941
                    > USED AT LINE 1948
                    > USED AT LINE 1971
                    > USED AT LINE 1974
FLOADFROMMEM:       0A13 DEFINED AT LINE 1552
                    > USED AT LINE 949
                    > USED AT LINE 1034
                    > USED AT LINE 1921
                    > USED AT LINE 1976
FLOADFROMBCDE:      0A16 DEFINED AT LINE 1553
                    > USED AT LINE 1219
                    > USED AT LINE 1227
                    > USED AT LINE 1294
                    > USED AT LINE 1409
                    > USED AT LINE 1790
                    > USED AT LINE 1830
                    > USED AT LINE 1944
FCOPYTOBCDE:        0A21 DEFINED AT LINE 1560
                    > USED AT LINE 583
                    > USED AT LINE 596
                    > USED AT LINE 1505
                    > USED AT LINE 1640
                    > USED AT LINE 1810
                    > USED AT LINE 1929
                    > USED AT LINE 1972
FLOADBCDEFROMMEM:   0A24 DEFINED AT LINE 1561
                    > USED AT LINE 956
                    > USED AT LINE 962
                    > USED AT LINE 1206
                    > USED AT LINE 1552
                    > USED AT LINE 1900
                    > USED AT LINE 1986
INCHLRETURN:        0A2B DEFINED AT LINE 1568
                    > USED AT LINE 1806
                    > USED AT LINE 1845
FCOPYTOMEM:         0A2D DEFINED AT LINE 1570
                    > USED AT LINE 756
                    > USED AT LINE 954
                    > USED AT LINE 1895
                    > USED AT LINE 1939
FCOPYLOOP:          0A32 DEFINED AT LINE 1572
                    > USED AT LINE 1577
FUNPACKMANTISSAS:   0A3B DEFINED AT LINE 1579
                    > USED AT LINE 1231
                    > USED AT LINE 1495
                    > USED AT LINE 1641
FCOMPARE:           0A50 DEFINED AT LINE 1598
                    > USED AT LINE 787
                    > USED AT LINE 958
                    > USED AT LINE 1775
                    > USED AT LINE 1870
FISEQUAL:           0A68 DEFINED AT LINE 1614
                    > USED AT LINE 1610
FASINTEGER:         0A7B DEFINED AT LINE 1633
                    > USED AT LINE 681
                    > USED AT LINE 1666
                    > USED AT LINE 1789
FMANTISSADEC:       0A9F DEFINED AT LINE 1655
                    > USED AT LINE 1644
INT:                0AA6 DEFINED AT LINE 1662
                    > USED AT LINE 76
                    > USED AT LINE 1949
FIN:                0AB7 DEFINED AT LINE 1671
                    > USED AT LINE 1008
                    > USED AT LINE 1014
FINLOOP:            0AC0 DEFINED AT LINE 1678
                    > USED AT LINE 1701
                    > USED AT LINE 1739
GETEXPONENT:        0ACE DEFINED AT LINE 1684
NEXTEXPONENTDIGIT:  0ADC DEFINED AT LINE 1692
                    > USED AT LINE 1687
                    > USED AT LINE 1690
                    > USED AT LINE 1748
L0AE4:              0AE8 DEFINED AT LINE 1700
                    > USED AT LINE 1681
SCALERESULT:        0AEC DEFINED AT LINE 1702
                    > USED AT LINE 1683
                    > USED AT LINE 1695
DECIMALLOOP:        0AEF DEFINED AT LINE 1705
                    > USED AT LINE 1711
DECIMALLOOPEND:     0AFB DEFINED AT LINE 1711
                    > USED AT LINE 1706
DECIMALSHIFTUP:     0B00 DEFINED AT LINE 1714
                    > USED AT LINE 1705
                    > USED AT LINE 1779
PROCESSDIGIT:       0B08 DEFINED AT LINE 1720
                    > USED AT LINE 1679
DOEXPONENTDIGIT:    0B27 DEFINED AT LINE 1740
                    > USED AT LINE 1693
PRINTIN:            0B33 DEFINED AT LINE 1749
                    > USED AT LINE 264
PRINTINT:           0B3B DEFINED AT LINE 1753
                    > USED AT LINE 536
                    > USED AT LINE 2114
FOUT:               0B46 DEFINED AT LINE 1759
                    > USED AT LINE 814
DOZERO:             0B52 DEFINED AT LINE 1765
                    > USED AT LINE 1763
TOOVER100000:       0B61 DEFINED AT LINE 1773
                    > USED AT LINE 1781
L0B71:              0B75 DEFINED AT LINE 1782
                    > USED AT LINE 1872
PREPARETOPRINT:     0B7E DEFINED AT LINE 1787
                    > USED AT LINE 1776
L0B95:              0B99 DEFINED AT LINE 1800
                    > USED AT LINE 1794
                    > USED AT LINE 1796
NEXTDIGIT:          0B9F DEFINED AT LINE 1804
                    > USED AT LINE 1837
DIGITLOOP:          0BAE DEFINED AT LINE 1813
                    > USED AT LINE 1827
L0BCF:              0BD3 DEFINED AT LINE 1840
                    > USED AT LINE 1843
L0BDB:              0BDF DEFINED AT LINE 1846
                    > USED AT LINE 1839
L0BEB:              0BEF DEFINED AT LINE 1855
                    > USED AT LINE 1851
EXPDIGITLOOP:       0BF1 DEFINED AT LINE 1856
                    > USED AT LINE 1858
NULLTERM:           0BFE DEFINED AT LINE 1865
                    > USED AT LINE 1767
                    > USED AT LINE 1847
TOUNDER1000000:     0C01 DEFINED AT LINE 1868
                    > USED AT LINE 1772
                    > USED AT LINE 1786
ONE_HALF:           0C0F DEFINED AT LINE 1876
                    > USED AT LINE 1205
DECIMAL_POWERS:     0C13 DEFINED AT LINE 1877
                    > USED AT LINE 1803
SQR:                0C25 DEFINED AT LINE 1883
                    > USED AT LINE 79
                    > USED AT LINE 2134
SQRLOOP:            0C3D DEFINED AT LINE 1897
                    > USED AT LINE 1911
RND:                0C63 DEFINED AT LINE 1918
                    > USED AT LINE 80
                    > USED AT LINE 2130
L0C7C:              0C80 DEFINED AT LINE 1929
                    > USED AT LINE 1919
RND_SEED:           0C95 DEFINED AT LINE 1940
                    > USED AT LINE 1920
                    > USED AT LINE 1938
SIN:                0C99 DEFINED AT LINE 1941
                    > USED AT LINE 81
                    > USED AT LINE 2127
NEGATEIFPOSITIVE:   0CC7 DEFINED AT LINE 1963
                    > USED AT LINE 1959
TAYLORLOOP:         0CED DEFINED AT LINE 1980
                    > USED AT LINE 1994
TAYLOR_SERIES:      0D07 DEFINED AT LINE 1996
                    > USED AT LINE 1975
L0D17:              0D1B DEFINED AT LINE 2001
                    > USED AT LINE 2124
INIT:               0D25 DEFINED AT LINE 2003
                    > USED AT LINE 22
                    > USED AT LINE 269
CONFIGIOCODE:       0D30 DEFINED AT LINE 2010
FINDMEMTOPLOOP:     0D4A DEFINED AT LINE 2020
                    > USED AT LINE 2031
L0DDE:              0D61 DEFINED AT LINE 2033
                    > USED AT LINE 2018
DONEMEMSIZE:        0D6D DEFINED AT LINE 2040
                    > USED AT LINE 2023
                    > USED AT LINE 2027
                    > USED AT LINE 2032
GETTERMINALWIDTH:   0D6F DEFINED AT LINE 2043
                    > USED AT LINE 2053
                    > USED AT LINE 2056
CALCTABBRKSIZE:     0D91 DEFINED AT LINE 2059
                    > USED AT LINE 2060
DOOPTIONALFNS:      0D9E DEFINED AT LINE 2067
                    > USED AT LINE 2048
                    > USED AT LINE 2082
OPTIONALFNSLOOP:    0DA1 DEFINED AT LINE 2068
                    > USED AT LINE 2090
L0E32:              0DB5 DEFINED AT LINE 2079
                    > USED AT LINE 2071
INITPROGRAMBASE:    0DCA DEFINED AT LINE 2092
                    > USED AT LINE 2080
OPT_FN_DESCS:       0E08 DEFINED AT LINE 2124
                    > USED AT LINE 2067
SZWANTSIN:          0E1C DEFINED AT LINE 2136
                    > USED AT LINE 2069
                    > USED AT LINE 2125
SZWANTRND:          0E25 DEFINED AT LINE 2137
                    > USED AT LINE 2128
SZWANTSQR:          0E2E DEFINED AT LINE 2138
                    > USED AT LINE 2131
SZTERMINALWIDTH:    0E37 DEFINED AT LINE 2141
                    > USED AT LINE 2043
SZVERSIONINFO:      0E46 DEFINED AT LINE 2143
                    > USED AT LINE 2115
SZMEMORYSIZE:       0E73 DEFINED AT LINE 2146
                    > USED AT LINE 2013
UNUSEDMEMORY:       0E7F DEFINED AT LINE 2150
                    > USED AT LINE 2019